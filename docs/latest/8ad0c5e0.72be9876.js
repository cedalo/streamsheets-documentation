(window.webpackJsonp=window.webpackJsonp||[]).push([[161],{228:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(3),r=n(7),o=(n(0),n(377)),i={id:"addons",title:"Add-Ons",sidebar_label:"Add-Ons"},c={unversionedId:"streamsheets/addons",id:"streamsheets/addons",isDocsHomePage:!1,title:"Add-Ons",description:"Adding components to the Streamsheets architecture is possible. These can be Streamsheets specific plugins like OpenID or general usuful additions to your IoT architecture like databases.",source:"@site/docs\\streamsheets\\addons.md",slug:"/streamsheets/addons",permalink:"/latest/docs/streamsheets/addons",version:"current",sidebar_label:"Add-Ons",sidebar:"someSidebar",previous:{title:"Glossary",permalink:"/latest/docs/streamsheets/glossary"},next:{title:"Cedalo Management Center",permalink:"/latest/docs/management-center/mc-overview"}},l=[{value:"Open ID Connect",id:"open-id-connect",children:[{value:"OpenID in Streamsheets",id:"openid-in-streamsheets",children:[]},{value:"Configuration of the Plugin",id:"configuration-of-the-plugin",children:[]},{value:"Configuration at the Issuer",id:"configuration-at-the-issuer",children:[]}]},{value:"MongoDB",id:"mongodb",children:[]}],b={rightToc:l};function s(e){var t=e.components,i=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},b,i,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Adding components to the Streamsheets architecture is possible. These can be Streamsheets specific plugins like OpenID or general usuful additions to your IoT architecture like databases. "),Object(o.b)("h2",{id:"open-id-connect"},"Open ID Connect"),Object(o.b)("p",null,"OpenID Connect is a professional feature ",Object(o.b)("img",{alt:"star",src:n(378).default})),Object(o.b)("p",null,"Streamsheets allows the coupling of existing user bases to your Streamsheets installation by using OpenID Connect.\nOpenID Connect is an open standard and decentralized authentication protocol on top of OAuth 2.0. It allows clients to verify the identity of the End-User based on the authentication performed by an Authorization Server, as well as to obtain basic profile information about the End-User in an interoperable and REST-like manner. To get more information on OpenID click ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://openid.net/connect/"}),"here"),". "),Object(o.b)("h3",{id:"openid-in-streamsheets"},"OpenID in Streamsheets"),Object(o.b)("p",null,'OpenID Connect is available as a separate professional plugin and not part of the standard professional image. After activating this plugin, users are automatically created on the first sign-in. The initial role and workspace for new users can be configured via environment variables.\nTo use this plugin, put the "openid" plugin folder in the streamsheets directory and reference the ',Object(o.b)("inlineCode",{parentName:"p"},"docker-compose.openid.yml")," in the ",Object(o.b)("inlineCode",{parentName:"p"},"start.sh"),":"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},'Create a "plugins" directory in your streamsheets installation directory (next to "settings" and "docker-compose")'),Object(o.b)("li",{parentName:"ul"},'Put the "openid" directory into the "./plugins" directory. '),Object(o.b)("li",{parentName:"ul"},"Run ",Object(o.b)("inlineCode",{parentName:"li"},"npm install"),' in the "openid" plugin directory.'),Object(o.b)("li",{parentName:"ul"},"Update the configuration in the ",Object(o.b)("inlineCode",{parentName:"li"},"docker-compose.openid.yml"),":",Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"# URL of the issuer\nSTREAMSHEETS_OPENID_ISSUER_URL: '<ISSUER_URL>'        \n# Client ID provided by the issuer\nSTREAMSHEETS_OPENID_CLIENT_ID: '<CLIENT_ID>'          \n# Client Secret provided by the issuer\nSTREAMSHEETS_OPENID_CLIENT_SECRET: '<CLIENT_SECRET>'  \n# Streamsheets host, e.g 'https://streamsheets.example.org' or `http://localhost:8080`\nSTREAMSHEETS_HOST: '<STREAMSHEETS_HOST>'                      \n")))),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Add the following line to the ",Object(o.b)("inlineCode",{parentName:"p"},"start.sh")," right before ",Object(o.b)("inlineCode",{parentName:"p"},"$CMD"),":"),Object(o.b)("p",{parentName:"li"},Object(o.b)("inlineCode",{parentName:"p"},"-f ./plugins/openid/docker-compose.openid.yml \\")),Object(o.b)("p",{parentName:"li"},"  It should look like this now:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(a.a)({parentName:"pre"},{}),"docker-compose \\\n    -f ./docker-compose/docker-compose.prod.yml \\\n    -f ./plugins/openid/docker-compose.openid.yml \\\n    $CMD\n")))),Object(o.b)("h3",{id:"configuration-of-the-plugin"},"Configuration of the Plugin"),Object(o.b)("p",null,"The following parameters can be set to configure how users are handled the first time they sign into streamsheets via OpenID Connect."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"STREAMSHEETS_OPENID_INITIAL_ADMIN"),", default ",Object(o.b)("inlineCode",{parentName:"li"},"false"),". If ",Object(o.b)("inlineCode",{parentName:"li"},"true"),", all new users have full administrative rights."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"STREAMSHEETS_OPENID_INITIAL_WORKSPACE"),". If set to a workspace ID, the user is automatically added to the workspace and is assigned the role specified by ",Object(o.b)("inlineCode",{parentName:"li"},"STREAMSHEETS_OPENID_INITIAL_ROLE"),"."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"STREAMSHEETS_OPENID_INITIAL_ROLE"),", default ",Object(o.b)("inlineCode",{parentName:"li"},"viewer"),", allowed values ",Object(o.b)("inlineCode",{parentName:"li"},"viewer"),", ",Object(o.b)("inlineCode",{parentName:"li"},"developer"),". The role a user is assigned in the workspace specified by ",Object(o.b)("inlineCode",{parentName:"li"},"STREAMSHEETS_OPENID_INITIAL_WORKSPACE"),"."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"STREAMSHEETS_DEFAULT_AUTH_MECHANISM"),". If ",Object(o.b)("inlineCode",{parentName:"li"},"openid"),", the user will be redirected to the configured issuer without seeing the Streamsheets login page. ")),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"The Streamsheets login page is still reachable by navigating to ",Object(o.b)("inlineCode",{parentName:"p"},"{baseURL}/login?provider=local"),"."))),Object(o.b)("h3",{id:"configuration-at-the-issuer"},"Configuration at the Issuer"),Object(o.b)("p",null,"Streamsheets requires the following configuration parameters to be set:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Scope: \t\t",Object(o.b)("inlineCode",{parentName:"li"},"openid user")),Object(o.b)("li",{parentName:"ul"},"Callback URL: ",Object(o.b)("inlineCode",{parentName:"li"},"<STREAMSHEETS_HOST>/openid/callback"))),Object(o.b)("h2",{id:"mongodb"},"MongoDB"),Object(o.b)("p",null,"Streamsheets come with the option to connect to any MongoDB you need. If\nyou don\xb4t have a MongoDB yet, it is fairly simple to setup. While\nStreamsheets run with docker, the same possibility exists for MongoDB."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Setup Mongo Database")),Object(o.b)("p",null,"Open a terminal of your choice and enter:"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Command:\n",Object(o.b)("inlineCode",{parentName:"p"},"docker run --name <container-name> --net streamsheets mongo"),Object(o.b)("br",{parentName:"p"}),"\n","Example: ",Object(o.b)("inlineCode",{parentName:"p"},"docker run --name mymongodb --net streamsheets mongo"))),Object(o.b)("p",null,"If you have the Raspberry Pi version use:"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Command:\n",Object(o.b)("inlineCode",{parentName:"p"},"sudo docker run --name <container-name> --net streamsheets andresvidal/rpi3-mongodb3"),Object(o.b)("br",{parentName:"p"}),"\n","Example:\n",Object(o.b)("inlineCode",{parentName:"p"},"sudo docker run --name mymongodb --net streamsheets andresvidal/rpi3-mongodb3"))),Object(o.b)("p",null,"This command downloads a MongoDB image and runs it in a container named\n",Object(o.b)("inlineCode",{parentName:"p"},"container-name")," in the docker network \u201cstreamsheets\u201d. It is\nimportant that the container name does not contain capital letters!"),Object(o.b)("p",null,"Now you can create a new MongoDB Connector in the Administration Menu of\nyour Streamsheet installation. Check the \u201cExternal Host\u201d checkbox and\nenter the ",Object(o.b)("inlineCode",{parentName:"p"},"container-name")," under \u201cHost(s)\u201d. All other settings are\noptional. Add a Producer and use the MONGO.STORE function to safe your\nfirst datapoints to your very own MongoDB."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Start Stop MongoDB")),Object(o.b)("p",null,"To properly stop and start your created container enter:"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Command: ",Object(o.b)("inlineCode",{parentName:"p"},"docker stop <container-name>"),"\n",Object(o.b)("inlineCode",{parentName:"p"},"docker start <container-name>"),Object(o.b)("br",{parentName:"p"}),"\n","Example: ",Object(o.b)("inlineCode",{parentName:"p"},"docker stop mymongodb")," ",Object(o.b)("inlineCode",{parentName:"p"},"docker start mymongodb"))),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Further Settings")),Object(o.b)("p",null,"You can add these commands to the ",Object(o.b)("inlineCode",{parentName:"p"},"docker run")," command above."),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Command"),Object(o.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"Description"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"-publish 27017:27017")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"set the MongoDB port to 27017")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"-e MONGO_INITDB_ROOT_USERNAME=mongoadmin")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"adds root user")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"-e MONGO_INITDB_ROOT_PASSWORD=secret")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"adds root password")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"-v ./<directory>:/data/db")),Object(o.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"add the container data to a folder outside of the docker environment. (change ","<","directory",">"," to a real path)")))),Object(o.b)("p",null,"More can be found ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://hub.docker.com/_/mongo"}),"here"),"."))}s.isMDXComponent=!0},377:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return u}));var a=n(0),r=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var b=r.a.createContext({}),s=function(e){var t=r.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=s(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),p=s(n),m=a,u=p["".concat(i,".").concat(m)]||p[m]||d[m]||o;return n?r.a.createElement(u,c(c({ref:t},b),{},{components:n})):r.a.createElement(u,c({ref:t},b))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var b=2;b<o;b++)i[b]=n[b];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},378:function(e,t,n){"use strict";n.r(t),t.default="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTExLjk5IDJDNi40NyAyIDIgNi40OCAyIDEyczQuNDcgMTAgOS45OSAxMEMxNy41MiAyMiAyMiAxNy41MiAyMiAxMlMxNy41MiAyIDExLjk5IDJ6bTQuMjQgMTZMMTIgMTUuNDUgNy43NyAxOGwxLjEyLTQuODEtMy43My0zLjIzIDQuOTItLjQyTDEyIDVsMS45MiA0LjUzIDQuOTIuNDItMy43MyAzLjIzTDE2LjIzIDE4eiIvPjwvc3ZnPg=="}}]);