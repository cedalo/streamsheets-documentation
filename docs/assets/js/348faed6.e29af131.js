"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[83232],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(n),d=i,k=u["".concat(s,".").concat(d)]||u[d]||m[d]||r;return n?a.createElement(k,l(l({ref:t},c),{},{components:n})):a.createElement(k,l({ref:t},c))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=u;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},58138:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>f,contentTitle:()=>d,default:()=>C,frontMatter:()=>u,metadata:()=>k,toc:()=>h});var a=n(3905),i=Object.defineProperty,r=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,c=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&c(e,n,t[n]);if(o)for(var n of o(t))p.call(t,n)&&c(e,n,t[n]);return e};const u={id:"mtls",title:"mTLS",sidebar_label:"mTLS"},d=void 0,k={unversionedId:"security/certificates/mtls",id:"version-3.1/security/certificates/mtls",title:"mTLS",description:"Client certificates are a popular way of adding an extra layer of security to your client authentication.",source:"@site/mosquitto_versioned_docs/version-3.1/security/certificates/mtls.md",sourceDirName:"security/certificates",slug:"/security/certificates/mtls",permalink:"/mosquitto/security/certificates/mtls",draft:!1,tags:[],version:"3.1",frontMatter:{id:"mtls",title:"mTLS",sidebar_label:"mTLS"},sidebar:"someSidebar",previous:{title:"Server Certificates",permalink:"/mosquitto/security/certificates/server-certificates"},next:{title:"CA file management",permalink:"/mosquitto/security/certificates/ca-files"}},f={},h=[{value:"Listener configuration",id:"listener-configuration",level:2},{value:"Default Cloud configuration",id:"default-cloud-configuration",level:3},{value:"On-premises configuration",id:"on-premises-configuration",level:3},{value:"Certificate and Key Settings (Server-side)",id:"certificate-and-key-settings-server-side",level:4},{value:"Certificate and Key Settings (Client-side validation)",id:"certificate-and-key-settings-client-side-validation",level:4},{value:"Plugin configuration",id:"plugin-configuration",level:2},{value:"Control API",id:"control-api",level:3},{value:"Kubernetes and OpenShift Deployment",id:"kubernetes-and-openshift-deployment",level:2},{value:"Cluster Setup",id:"cluster-setup",level:3},{value:"Required Files",id:"required-files",level:4},{value:"Secret Creation",id:"secret-creation",level:4},{value:"Certificate Mounting",id:"certificate-mounting",level:4},{value:"Configuration Parameters",id:"configuration-parameters",level:4},{value:"First-Time Installation",id:"first-time-installation",level:4},{value:"Upgrade Installation",id:"upgrade-installation",level:4},{value:"Single Node Setup",id:"single-node-setup",level:3},{value:"Required Files",id:"required-files-1",level:4},{value:"Secret Creation",id:"secret-creation-1",level:4},{value:"Certificate Mounting",id:"certificate-mounting-1",level:4},{value:"First-Time Installation",id:"first-time-installation-1",level:4},{value:"Upgrade Installation",id:"upgrade-installation-1",level:4},{value:"Verification",id:"verification",level:2}],N={toc:h};function C(e){var t,n=e,{components:i}=n,c=((e,t)=>{var n={};for(var a in e)s.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&o)for(var a of o(e))t.indexOf(a)<0&&p.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=m(m({},N),c),r(t,l({components:i,mdxType:"MDXLayout"}))),(0,a.kt)("p",null,"Client certificates are a popular way of adding an extra layer of security to your client authentication.\nIt can either be added on top or instead of the regular authentication provided by\nthe role based authentication using username and password. While\nconnecting, a client identifies using a client certificate. The broker has stored a client certificate authority and\nallows a connection, if the client certificate gets validated, the connection is allowed."),(0,a.kt)("p",null,"The ",(0,a.kt)("a",m({parentName:"p"},{href:"/mosquitto/security/certificates/ca-files"}),"CA Management")," allows the upload of client CAs to the broker via a UI."),(0,a.kt)("h2",m({},{id:"listener-configuration"}),"Listener configuration"),(0,a.kt)("p",null,"MTLS has to be activated on a port (listener) level."),(0,a.kt)("h3",m({},{id:"default-cloud-configuration"}),"Default Cloud configuration"),(0,a.kt)("p",null,"The default broker configuration, when mTLS is selected in a cloud subscription for a port looks like this (shown with port 8883):"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-aconf"}),"# Listener for the application, MQTTS over TCP with client certs\nlistener 8883\ncertfile /mosquitto/config/certs/server.pem\nkeyfile /mosquitto/config/certs/server.key\ncapath /mosquitto/config/capath_mqtts\nrequire_certificate true\n\nenable_control_api true\n\nplugin /usr/lib/cedalo_certificate_management.so\n")),(0,a.kt)("p",null,"If you need any changes to this default please contact our support team."),(0,a.kt)("h3",m({},{id:"on-premises-configuration"}),"On-premises configuration"),(0,a.kt)("p",null,"The following options can be used for mTLS configuration."),(0,a.kt)("h4",m({},{id:"certificate-and-key-settings-server-side"}),"Certificate and Key Settings (Server-side)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"cafile <path>")),": Specifies the path to the Certificate Authority (CA) file that the broker will use to validate client certificates."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"capath <path>")),": Specifies the path to the Certificate Authority (CA) folder that the broker will use to validate client certificates. This is needed if more then one file is present."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"certfile <path>")),": The server's public certificate file that will be presented to clients during the TLS handshake."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"keyfile <path>")),": The server's private key file used to establish the TLS connection. The private key should remain secure and not be shared.")),(0,a.kt)("p",null,"The path of the ",(0,a.kt)("inlineCode",{parentName:"p"},"capath")," configuration should contain at least a root CA cert."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Note:"))," The ",(0,a.kt)("inlineCode",{parentName:"p"},"cafile")," configuration with a single PEM file containing the CA\nchain is currently not supported for this command."),(0,a.kt)("h4",m({},{id:"certificate-and-key-settings-client-side-validation"}),"Certificate and Key Settings (Client-side validation)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"require_certificate <true|false>")),": Determines whether clients are required to present a valid certificate for authentication. Set this to ",(0,a.kt)("inlineCode",{parentName:"li"},"true")," to enforce mTLS."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"tls_version <version>")),": Specifies the minimum TLS version allowed for the connection. Common values include ",(0,a.kt)("inlineCode",{parentName:"li"},"tlsv1.2")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"tlsv1.3")," to ensure a secure connection."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"strong"},"use_identity_as_username <true|false>")),": If set to ",(0,a.kt)("inlineCode",{parentName:"li"},"true"),", the broker will use the client certificate's Common Name (CN) field as the client's username for authentication.")),(0,a.kt)("h2",m({},{id:"plugin-configuration"}),"Plugin configuration"),(0,a.kt)("p",null,"To enable the plugin it must be loaded into the broker with, by adding the\nfollowing to your ",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.conf"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-aconf"}),"plugin /usr/lib/cedalo_certificate_management.so\n")),(0,a.kt)("h3",m({},{id:"control-api"}),"Control API"),(0,a.kt)("p",null,"In addition to enable the brokers internal ",(0,a.kt)("inlineCode",{parentName:"p"},"$CONTROL/broker/v1")," API we need to\nadd:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-aconf"}),"enable_control_api true\n")),(0,a.kt)("p",null,"This is required to determine the listeners identifier, where the changes should be applied to."),(0,a.kt)("p",null,"This plugin provides a Mosquitto control API which manages client CA certificates for\ncertificate based authentication/validation.\nThe topic of the plugin's control API is ",(0,a.kt)("inlineCode",{parentName:"p"},"$CONTROL/certificate-management/v1"),".\nCurrently, supported commands offered by the API are ",(0,a.kt)("inlineCode",{parentName:"p"},"insertCACertificate"),", which\ncan be used to extend the existing Certificate Authority (CA) Chain or just the\nRoot CA by an additional signing/validating certificate. To get rid of a\npreviously added CA cert, the ",(0,a.kt)("inlineCode",{parentName:"p"},"deleteCACertificate")," command can be used."),(0,a.kt)("h2",m({},{id:"kubernetes-and-openshift-deployment"}),"Kubernetes and OpenShift Deployment"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Note:"))," For OpenShift deployments, replace ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"oc")," in all commands below. The chart directory names differ:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Kubernetes Cluster: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-platform-kubernetes-cluster")),(0,a.kt)("li",{parentName:"ul"},"Kubernetes Single Node: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-platform-kubernetes-sn")),(0,a.kt)("li",{parentName:"ul"},"OpenShift Cluster: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-platform-openshift-cluster")),(0,a.kt)("li",{parentName:"ul"},"OpenShift Single Node: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-platform-openshift-sn"))),(0,a.kt)("h3",m({},{id:"cluster-setup"}),"Cluster Setup"),(0,a.kt)("h4",m({},{id:"required-files"}),"Required Files"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Server Certificates:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"server.pem")," - Server certificate (can contain certificate chain)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"server.key")," - Server private key")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Client CA Certificates:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ca.crt")," - CA certificate that signed the client certificates"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"<hash>.0")," - Hash-named file for Mosquitto capath (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"4b073644.0"),")")),(0,a.kt)("h4",m({},{id:"secret-creation"}),"Secret Creation"),(0,a.kt)("p",null,"Certificates can be created externally to Helm charts using ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"oc")," commands. This is the ",(0,a.kt)("strong",{parentName:"p"},"recommended approach")," as it's easier and provides better control over secret management. When using external secrets, set ",(0,a.kt)("inlineCode",{parentName:"p"},"createSecret: false")," in your Helm installation."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," The secret names and paths mentioned here are ",(0,a.kt)("strong",{parentName:"p"},"default values")," and can be configured via Helm values. See the Configuration Parameters section below for customization options."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For Kubernetes:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Create mTLS server certificate secret (using default secret name)\nkubectl create secret generic mosquitto-mtls-server-tls \\\n  --from-file=server.pem=server.pem \\\n  --from-file=server.key=server.key \\\n  -n $NAMESPACE\n\n# Calculate CA hash and create hash-named file\nHASH=$(openssl x509 -hash -noout -in ca.crt)\ncp ca.crt ${HASH}.0\n\n# Create client CA secret (using default secret name)\n# IMPORTANT: Client CA secret must always be created externally\nkubectl create secret generic mosquitto-client-ca \\\n  --from-file=ca.crt=ca.crt \\\n  --from-file=${HASH}.0=${HASH}.0 \\\n  -n $NAMESPACE\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For OpenShift:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Create mTLS server certificate secret (using default secret name)\noc create secret generic mosquitto-mtls-server-tls \\\n  --from-file=server.pem=server.pem \\\n  --from-file=server.key=server.key \\\n  -n $NAMESPACE\n\n# Calculate CA hash and create hash-named file\nHASH=$(openssl x509 -hash -noout -in ca.crt)\ncp ca.crt ${HASH}.0\n\n# Create client CA secret (using default secret name)\n# IMPORTANT: Client CA secret must always be created externally\noc create secret generic mosquitto-client-ca \\\n  --from-file=ca.crt=ca.crt \\\n  --from-file=${HASH}.0=${HASH}.0 \\\n  -n $NAMESPACE\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," When creating secrets externally:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Server certificate secret name must match ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.secretName")," (default: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-mtls-server-tls"),")"),(0,a.kt)("li",{parentName:"ul"},"Server certificate secret keys must match ",(0,a.kt)("inlineCode",{parentName:"li"},"certFile")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"keyFile")," values (defaults: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.pem")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"server.key"),")"),(0,a.kt)("li",{parentName:"ul"},"Client CA secret name must match ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.clientCaSecretName")," (default: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-client-ca"),")"),(0,a.kt)("li",{parentName:"ul"},"Client CA secret must include ",(0,a.kt)("inlineCode",{parentName:"li"},"ca.crt")," and hash-named files (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"4b073644.0"),")"),(0,a.kt)("li",{parentName:"ul"},"Set ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.createSecret=false")," in your Helm installation to use externally created server certificate secret"),(0,a.kt)("li",{parentName:"ul"},"Client CA secret is always external and cannot be created by Helm")),(0,a.kt)("h4",m({},{id:"certificate-mounting"}),"Certificate Mounting"),(0,a.kt)("p",null,"The Helm chart automatically mounts certificates as follows (all values shown are ",(0,a.kt)("strong",{parentName:"p"},"defaults")," and can be customized):"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Server Certificates:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Secret: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-mtls-server-tls")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.secretName"),")"),(0,a.kt)("li",{parentName:"ul"},"Mount Path: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mosquitto/config/certs/")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.tlsMountPath"),")"),(0,a.kt)("li",{parentName:"ul"},"Files: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.pem"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"server.key")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.certName")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.keyName"),")"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Client CA Certificates:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Secret: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-client-ca")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.clientCaSecretName"),")"),(0,a.kt)("li",{parentName:"ul"},"Mount Path: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mosquitto/config/capath_mqtts/")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.caMountPath"),")"),(0,a.kt)("li",{parentName:"ul"},"Files: ",(0,a.kt)("inlineCode",{parentName:"li"},"ca.crt"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"<hash>.0")," (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"4b073644.0"),")"),(0,a.kt)("li",{parentName:"ul"},"An init container copies files from the secret to an ",(0,a.kt)("inlineCode",{parentName:"li"},"emptyDir")," volume to ensure proper file permissions")))),(0,a.kt)("h4",m({},{id:"configuration-parameters"}),"Configuration Parameters"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," All secret names, file names, and mount paths mentioned below are ",(0,a.kt)("strong",{parentName:"p"},"default values")," and can be customized via Helm values. You can override any of these defaults to match your specific requirements."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Server Certificate Configuration:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.enabled"),": Enable mTLS (Mutual TLS) listener on port 8883. When enabled, both server and clients must present certificates for authentication. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"false"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.secretName"),": Kubernetes Secret name containing server TLS certificates for mTLS. This secret must exist if ",(0,a.kt)("inlineCode",{parentName:"p"},"createSecret")," is set to ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),". Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-mtls-server-tls"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.createSecret"),": If ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),", Helm will create the secret from ",(0,a.kt)("inlineCode",{parentName:"p"},"certContent")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"keyContent"),". If ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),", the secret must exist externally (created via ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"oc"),"). ",(0,a.kt)("strong",{parentName:"p"},"Recommended approach"),": Set to ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," and create secrets externally using ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl create secret")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"oc create secret")," commands, as this is easier and provides better control over secret management. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"true"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.certFile"),": Certificate file name (key) in the Kubernetes Secret. This should match the key name used when creating the secret externally. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"server.pem"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.keyFile"),": Private key file name (key) in the Kubernetes Secret. This should match the key name used when creating the secret externally. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"server.key"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.tlsMountPath"),": Directory path where server TLS certificates are mounted in the container. Should be a ",(0,a.kt)("strong",{parentName:"p"},"DIRECTORY path only")," (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"/mosquitto/config/certs"),"). Do not include the filename. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"/mosquitto/config/certs"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.certName"),": Certificate filename when mounted in the container. Should be a ",(0,a.kt)("strong",{parentName:"p"},"FILENAME only")," (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"server.pem"),"), no path. The final path is constructed as: ",(0,a.kt)("inlineCode",{parentName:"p"},"tlsMountPath/certName")," = ",(0,a.kt)("inlineCode",{parentName:"p"},"/mosquitto/config/certs/server.pem"),". Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"server.pem"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.keyName"),": Private key filename when mounted in the container. Should be a ",(0,a.kt)("strong",{parentName:"p"},"FILENAME only")," (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"server.key"),"), no path. The final path is constructed as: ",(0,a.kt)("inlineCode",{parentName:"p"},"tlsMountPath/keyName")," = ",(0,a.kt)("inlineCode",{parentName:"p"},"/mosquitto/config/certs/server.key"),". Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"server.key"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.certContent"),": Base64-encoded server certificate content. Only used when ",(0,a.kt)("inlineCode",{parentName:"p"},"createSecret: true"),". If ",(0,a.kt)("inlineCode",{parentName:"p"},"createSecret: false"),", this parameter is ignored and the secret must be created externally with keys matching ",(0,a.kt)("inlineCode",{parentName:"p"},"certFile")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"keyFile"),". Default: ",(0,a.kt)("inlineCode",{parentName:"p"},'""')," (empty string)")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.keyContent"),": Base64-encoded server private key content. Only used when ",(0,a.kt)("inlineCode",{parentName:"p"},"createSecret: true"),". If ",(0,a.kt)("inlineCode",{parentName:"p"},"createSecret: false"),", this parameter is ignored and the secret must be created externally with keys matching ",(0,a.kt)("inlineCode",{parentName:"p"},"certFile")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"keyFile"),". Default: ",(0,a.kt)("inlineCode",{parentName:"p"},'""')," (empty string)"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Client CA Certificate Configuration:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.clientCaSecretName"),": Kubernetes Secret name containing client CA certificates. ",(0,a.kt)("strong",{parentName:"p"},"IMPORTANT"),": This secret must be created externally before deploying. It cannot be created by Helm. The secret must contain ",(0,a.kt)("inlineCode",{parentName:"p"},"ca.crt")," and hash-named files (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"4b073644.0"),"). Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-client-ca"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.caMountPath"),": Directory path where client CA certificates are mounted in the container. This is the ",(0,a.kt)("inlineCode",{parentName:"p"},"capath")," directory that Mosquitto uses to validate client certificates. Should be a ",(0,a.kt)("strong",{parentName:"p"},"DIRECTORY path only")," (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"/mosquitto/config/capath_mqtts"),"). Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"/mosquitto/config/capath_mqtts")))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Client Certificate Validation Configuration:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.requireCertificate"),": Determines whether clients are required to present a valid certificate for authentication. Set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true")," to enforce mTLS (clients must present certificates). Set to ",(0,a.kt)("inlineCode",{parentName:"p"},"false")," to make client certificates optional. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"true"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.useIdentityAsUsername"),": If set to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),", the broker will use the client certificate's Common Name (CN) field as the client's username for authentication. If ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),", clients must provide username/password separately. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},"false"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.mtls.tlsVersion"),": Specifies the minimum TLS version allowed for the connection. Common values include ",(0,a.kt)("inlineCode",{parentName:"p"},"tlsv1.2")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"tlsv1.3")," to ensure a secure connection. Leave empty to use Mosquitto's default TLS version. Default: ",(0,a.kt)("inlineCode",{parentName:"p"},'""')," (empty string, uses Mosquitto default)"))),(0,a.kt)("h4",m({},{id:"first-time-installation"}),"First-Time Installation"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For Kubernetes Cluster:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Install with mTLS enabled\nhelm install mosquitto-platform \\\n  ./mosquitto-platform-kubernetes-cluster \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n\n# Rollout HAProxy to pick up mTLS configuration\nkubectl rollout restart deployment haproxy -n $NAMESPACE\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For OpenShift Cluster:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Install with mTLS enabled\nhelm install mosquitto-platform \\\n  ./mosquitto-platform-openshift-cluster \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n\n# Rollout HAProxy to pick up mTLS configuration\noc rollout restart deployment haproxy -n $NAMESPACE\n')),(0,a.kt)("h4",m({},{id:"upgrade-installation"}),"Upgrade Installation"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For Kubernetes Cluster:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Upgrade with mTLS enabled\nhelm upgrade mosquitto-platform \\\n  ./mosquitto-platform-kubernetes-cluster \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n\n# Rollout HAProxy to pick up mTLS configuration changes\nkubectl rollout restart deployment haproxy -n $NAMESPACE\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For OpenShift Cluster:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Upgrade with mTLS enabled\nhelm upgrade mosquitto-platform \\\n  ./mosquitto-platform-openshift-cluster \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n\n# Rollout HAProxy to pick up mTLS configuration changes\noc rollout restart deployment haproxy -n $NAMESPACE\n')),(0,a.kt)("h3",m({},{id:"single-node-setup"}),"Single Node Setup"),(0,a.kt)("h4",m({},{id:"required-files-1"}),"Required Files"),(0,a.kt)("p",null,"Same as Cluster Setup:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"server.pem")," - Server certificate"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"server.key")," - Server private key"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"ca.crt")," - Client CA certificate"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"<hash>.0")," - Hash-named file for Mosquitto capath")),(0,a.kt)("h4",m({},{id:"secret-creation-1"}),"Secret Creation"),(0,a.kt)("p",null,"Same as Cluster Setup (see above). The secret names and paths are ",(0,a.kt)("strong",{parentName:"p"},"default values")," and can be configured via Helm values. See the Configuration Parameters section in Cluster Setup above for customization options."),(0,a.kt)("h4",m({},{id:"certificate-mounting-1"}),"Certificate Mounting"),(0,a.kt)("p",null,"Same mount paths as Cluster Setup (all values are ",(0,a.kt)("strong",{parentName:"p"},"defaults")," and can be customized):"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Server certificates: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mosquitto/config/certs/")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.tlsMountPath"),")"),(0,a.kt)("li",{parentName:"ul"},"Client CA certificates: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mosquitto/config/capath_mqtts/")," (configurable via ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.mtls.caMountPath"),")")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," Single node deployments do not include HAProxy, so certificates are mounted directly to the Mosquitto StatefulSet."),(0,a.kt)("h4",m({},{id:"first-time-installation-1"}),"First-Time Installation"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For Kubernetes Single Node:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Install with mTLS enabled\nhelm install mosquitto-platform \\\n  ./mosquitto-platform-kubernetes-sn \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For OpenShift Single Node:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Install with mTLS enabled\nhelm install mosquitto-platform \\\n  ./mosquitto-platform-openshift-sn \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n')),(0,a.kt)("h4",m({},{id:"upgrade-installation-1"}),"Upgrade Installation"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For Kubernetes Single Node:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Upgrade with mTLS enabled\nhelm upgrade mosquitto-platform \\\n  ./mosquitto-platform-kubernetes-sn \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"For OpenShift Single Node:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Set namespace\nNAMESPACE="your-namespace"\n\n# Upgrade with mTLS enabled\nhelm upgrade mosquitto-platform \\\n  ./mosquitto-platform-openshift-sn \\\n  -n $NAMESPACE \\\n  -f values.yaml \\\n  --set mosquitto.mtls.enabled=true \\\n  --set mosquitto.mtls.createSecret=false\n')),(0,a.kt)("h2",m({},{id:"verification"}),"Verification"),(0,a.kt)("p",null,"After installation, verify that certificates are properly mounted:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Check server certificates\nkubectl exec mosquitto-0 -n $NAMESPACE -- ls -la /mosquitto/config/certs/\n# Should show: server.pem and server.key\n\n# Check client CA certificates in capath\nkubectl exec mosquitto-0 -n $NAMESPACE -- ls -la /mosquitto/config/capath_mqtts/\n# Should show: ca.crt and <hash>.0 (e.g., 4b073644.0)\n\n# Verify Mosquitto configuration\nkubectl exec mosquitto-0 -n $NAMESPACE -- grep -A 10 "listener.*8883" /mosquitto/config/mosquitto.conf\n# Should show mTLS listener configuration with certfile, keyfile, capath, and require_certificate\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},(0,a.kt)("em",{parentName:"strong"},"Note:"))," For OpenShift, replace ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"oc")," in the verification commands above."))}C.isMDXComponent=!0}}]);