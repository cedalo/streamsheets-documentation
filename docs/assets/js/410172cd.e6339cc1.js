"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[57509],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),m=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=m(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),d=m(n),c=i,k=d["".concat(s,".").concat(c)]||d[c]||p[c]||o;return n?a.createElement(k,l(l({ref:t},u),{},{components:n})):a.createElement(k,l({ref:t},u))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,l=new Array(o);l[0]=d;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:i,l[1]=r;for(var m=2;m<o;m++)l[m]=n[m];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},74431:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>f,frontMatter:()=>d,metadata:()=>k,toc:()=>g});var a=n(3905),i=Object.defineProperty,o=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,p=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&u(e,n,t[n]);if(r)for(var n of r(t))m.call(t,n)&&u(e,n,t[n]);return e};const d={id:"multi-node-single-host",title:"HA-Single-host",sidebar_label:"HA-Single-host"},c=void 0,k={unversionedId:"kubernetes/multi-node-single-host",id:"version-2.8/kubernetes/multi-node-single-host",title:"HA-Single-host",description:"To set up a multi-node Mosquitto broker and Management Center on a single host using Helm charts, you'll first need a Kubernetes environment. For deploying kubernetes on a single host, Minikube is an excellent choice. Minikube is a lightweight Kubernetes distribution designed for local development and testing (Discussed in Introduction section).",source:"@site/mosquitto_versioned_docs/version-2.8/kubernetes/multi-node-single-host.md",sourceDirName:"kubernetes",slug:"/kubernetes/multi-node-single-host",permalink:"/mosquitto/2.8/kubernetes/multi-node-single-host",draft:!1,tags:[],version:"2.8",frontMatter:{id:"multi-node-single-host",title:"HA-Single-host",sidebar_label:"HA-Single-host"},sidebar:"someSidebar",previous:{title:"Single Node",permalink:"/mosquitto/2.8/kubernetes/single-node"},next:{title:"High Availability",permalink:"/mosquitto/2.8/kubernetes/high-availability"}},h={},g=[{value:"Kubernetes Cluster Setup",id:"kubernetes-cluster-setup",level:2},{value:"Dependencies and Prerequisites:",id:"dependencies-and-prerequisites",level:3},{value:"Installation",id:"installation",level:2},{value:"Helm Installation",id:"helm-installation",level:3},{value:"Open Applications: MMC",id:"open-applications-mmc",level:3},{value:"Connect to the Mosquitto",id:"connect-to-the-mosquitto",level:3},{value:"Further Useful Commands:",id:"further-useful-commands",level:3},{value:"Create Cluster in Management Center",id:"create-cluster-in-management-center",level:2},{value:"Usage",id:"usage",level:2}],N={toc:g};function f(e){var t,n=e,{components:i}=n,u=((e,t)=>{var n={};for(var a in e)s.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&r)for(var a of r(e))t.indexOf(a)<0&&m.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=p(p({},N),u),o(t,l({components:i,mdxType:"MDXLayout"}))),(0,a.kt)("p",null,"To set up a multi-node Mosquitto broker and Management Center on a single host using Helm charts, you'll first need a Kubernetes environment. For deploying kubernetes on a single host, Minikube is an excellent choice. Minikube is a lightweight Kubernetes distribution designed for local development and testing (Discussed in Introduction section)."),(0,a.kt)("p",null,"This setup would deploy a 3 Mosquitto broker as statefulsets. Also, a Management-Center pod and HA-proxy pod as a deployment entity. All the deployment would be deployed on the same host."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Recommended Setup")),(0,a.kt)("p",null,"1 MMC and 3 Mosquitto Brokers (single host)"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"HA-PROXY Configurations"),"\nHA-proxy need to be configured accordingly for the kubernetes setup. For server m1, m2 and m3 needs to be configured in this case. Instead of using docker IP we would use DNS names to address the pods. For eg\n",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-0.mosquitto.multinode.svc.cluster.local"),". Here ",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-0"),",",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-1"),",",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-2")," are the name of individual mosquitto pods running as statefulsets. Each new pod would increase its pod-ordinal by 1. Rest can be defined as follows\n",(0,a.kt)("inlineCode",{parentName:"p"},"<pod-name>.<name-of-the-statefulset>.<namespace>.svc.cluster.local")),(0,a.kt)("p",null,'Your setup folder comes along with a default configuration of haproxy config which is given below. This assumes that your using namespace name as "multinode". You can also change the namespace name if you want and the procedure to do it would be discussed at a later stage.'),(0,a.kt)("pre",null,(0,a.kt)("code",p({parentName:"pre"},{}),"global\n    daemon\n    maxconn 4096\n\nfrontend mqtt_frontend\n    bind *:1883\n    mode tcp\n    default_backend mqtt_backend\n    timeout client 10m\n\nbackend mqtt_backend\n    timeout connect 5000\n    timeout server 10m\n    mode tcp\n    option redispatch\n    server m1 mosquitto-0.mosquitto.multinode.svc.cluster.local:1883 check on-marked-down shutdown-sessions\n    server m2 mosquitto-1.mosquitto.multinode.svc.cluster.local:1883 check on-marked-down shutdown-sessions\n    server m3 mosquitto-2.mosquitto.multinode.svc.cluster.local:1883 check on-marked-down shutdown-sessions\n")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Note"),": Make sure to add more entries to this haconfig.yaml file if you wish to add nodes to this cluster. You would have to reconfigure the haconfig.yaml inside helm charts  in that case."),(0,a.kt)("h2",p({},{id:"kubernetes-cluster-setup"}),"Kubernetes Cluster Setup"),(0,a.kt)("p",null,"If you need to set up a Kubernetes cluster, you can follow these steps:"),(0,a.kt)("h3",p({},{id:"dependencies-and-prerequisites"}),"Dependencies and Prerequisites:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Docker"),(0,a.kt)("li",{parentName:"ul"},"Minikube"),(0,a.kt)("li",{parentName:"ul"},"Helm")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Setup the folder on your local machine:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Copy or setup the ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes")," repository to your local machine. Also make sure to create a directory inside the repository named ",(0,a.kt)("inlineCode",{parentName:"li"},"license")," that contains the ",(0,a.kt)("inlineCode",{parentName:"li"},"license.lic")," file we provided you.  So the relative path would be ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/license/license.lic"),"."),(0,a.kt)("li",{parentName:"ul"},"Make sure all the ",(0,a.kt)("inlineCode",{parentName:"li"},"data")," directories have adequate privileges so that mosquitto kubernetes pods can create additional directories inside these ",(0,a.kt)("inlineCode",{parentName:"li"},"data")," directories. We provide ",(0,a.kt)("inlineCode",{parentName:"li"},"1000")," ownership to the data directory of mosquitto servers and ",(0,a.kt)("inlineCode",{parentName:"li"},"root")," ownership to config of management-center. The same ownership are also the default ownership of mosquitto pods and MMC pods.",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",p({parentName:"pre"},{}),"  `sudo chown -R 1000:1000 /home/<user>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/server1/mosquitto/data`\n  `sudo chown -R 1000:1000 /home/<user>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/server2/mosquitto/data`\n  `sudo chown -R 1000:1000 /home/<user>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/server3/mosquitto/data`\n  `sudo chown -R root:root /home/<user>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/server1/management-center/config`\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Note"),": We provide ownership of ",(0,a.kt)("inlineCode",{parentName:"li"},"1000")," as mosquitto kubernetes pods uses user id of ",(0,a.kt)("inlineCode",{parentName:"li"},"1000")," by default and ",(0,a.kt)("inlineCode",{parentName:"li"},"root")," to MMC pods."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Choose Architecture Folder:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Depending on your host architecture, navigate to the corresponding folder:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"For Debian AMD64:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"cd mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/kubernetes/multi-node-single-host/debian_amd64\n"))),(0,a.kt)("li",{parentName:"ul"},"For Ubuntu AMD64:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"cd mosquitto-2.8-mmc-2.8-singlenode-kubernetes/kubernetes/multi-node-single-host/ubuntu_amd64\n"))))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Install Pre-requisites:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Run the following command to install the necessary dependencies on the host. This script installs the dependencies like docker, minikube and helm. You can also install the dependencies separately on your own as well. To run the script use the following command:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"bash  install-dependencies.sh\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Start Minikube:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"On your local node"),":  Start the minikube setup using the ",(0,a.kt)("inlineCode",{parentName:"p"},"minikube start")," command mentioned below.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"repoPath"),": Replace the ",(0,a.kt)("inlineCode",{parentName:"p"},"repoPath")," variable with the path where the folder ",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes")," resides on your local. For eg if it exists on ",(0,a.kt)("inlineCode",{parentName:"p"},"/root/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes"),"  therefore the ",(0,a.kt)("inlineCode",{parentName:"p"},"repoPath")," would be ",(0,a.kt)("inlineCode",{parentName:"p"},"/root")," or if exists on ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/demo/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes")," then the ",(0,a.kt)("inlineCode",{parentName:"p"},"repoPath")," would be ",(0,a.kt)("inlineCode",{parentName:"p"},"/home/demo"),"."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},'minikube start --mount-string="<repoPath>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/:/mnt" --mount'))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Create a namespace")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"On your local node"),": Create a namespace in which you would want to deploy the application. The deployment folder is pre-configured for the namespace named ",(0,a.kt)("inlineCode",{parentName:"li"},"multinode"),". If you want to use the default configuration you can create a namespace named ",(0,a.kt)("inlineCode",{parentName:"li"},"multinode")," using the below command:"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl create namespace multinode")),(0,a.kt)("li",{parentName:"ul"},"If you want to use a different namespace, use the command: ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl create namespace <your-custom-namespace>"),".  Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"<your-custom-namespace>")," with the name of the namespace you want to configure."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Create configmap for your license")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"On your local node"),": Create a configmap for your license key. You can create the configmap using the following command:"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl create configmap mosquitto-license -n <namespace> --from-file=<path-to-your-license-file>")),(0,a.kt)("li",{parentName:"ul"},"Make sure the name of the configmap remains the same as  ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-license")," as this is required by the deployment files and statefulsets."),(0,a.kt)("li",{parentName:"ul"},"A sample configmap creation command would look something like this if the choosen namespace is ",(0,a.kt)("inlineCode",{parentName:"li"},"multinode")," and the license file is at the path ",(0,a.kt)("inlineCode",{parentName:"li"},"/home/<user>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/license/license.lic")," :",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl create configmap mosquitto-license -n multinode --from-file=/home/<user>/mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/license/license.lic"))))))),(0,a.kt)("h2",p({},{id:"installation"}),"Installation"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Prerequisites"),":"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Minikube should be up and running. If you are yet to setup the minikube for single-node deployment, refer ",(0,a.kt)("a",p({parentName:"li"},{href:"#kubernetes-setup"}),"Kubernetes  Setup"),"."),(0,a.kt)("li",{parentName:"ol"},"You have successfully created the namespace and configmap for your license (i.e ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-license"),").")),(0,a.kt)("h3",p({},{id:"helm-installation"}),"Helm Installation"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Change Directory:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Navigate to the project directory (i.e multi-node-single-host).\n",(0,a.kt)("inlineCode",{parentName:"li"},"cd mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/kubernetes/multi-node-single-host")))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Install Helm Chart:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Use the following ",(0,a.kt)("inlineCode",{parentName:"li"},"helm install")," command to deploy the setup to your Kubernetes cluster. Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"<release-name>")," with the desired name for your Helm release and ",(0,a.kt)("inlineCode",{parentName:"li"},"<namespace>")," with your chosen Kubernetes namespace:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"helm install <release-name> mosquitto-multi-node-single-host-0.1.0.tgz  -n <namespace> --set imageCredentials.registry=registry.cedalo.com --set imageCredentials.username=<username> --set imageCredentials.password=<password> --set imageCredentials.email=<email>\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"namespace"),": Set it to the namespace of your deployment."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Note"),": If you want to deploy the setup in a different namespace other than ",(0,a.kt)("inlineCode",{parentName:"li"},"multinode"),", make sure to pass a separate flag ",(0,a.kt)("inlineCode",{parentName:"li"},"--set namespace=<your-custom-namespace>")," along with the helm installation command."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"imageCredentials.username"),": Your docker username provided by Cedalo team."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"imageCredentials.password"),": Your docker password provided by Cedalo team."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"imageCredentials.email"),": Registered e-mail for accessing docker registry."),(0,a.kt)("li",{parentName:"ul"},"Sample example: If your name namespace is ",(0,a.kt)("inlineCode",{parentName:"li"},"test-namespace")," and your arbitrary release name is ",(0,a.kt)("inlineCode",{parentName:"li"},"sample-release-name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"username"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"password")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"email")," be ",(0,a.kt)("inlineCode",{parentName:"li"},"demo-username"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"demo-password")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"demo@gmail.com"),"  then your helm installation command should be:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",p({parentName:"pre"},{className:"language-bash"}),"   helm install sample-release-name  mosquitto-multi-node-single-host-0.1.0.tgz   --set -n test-namespace --set namespace=test-namespace --set imageCredentials.registry=registry.cedalo.com --set imageCredentials.username=demo-username --set imageCredentials.password=demo-password --set imageCredentials.email=demo@gmail.com\n"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"You can monitor the running pods using the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods -o wide -n <namespace>")," command. To observe the opened ports use ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get svc -n <namespace>"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"To uninstall the setup:\n",(0,a.kt)("inlineCode",{parentName:"p"},"helm uninstall <release-name> -n <namespace>"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"To delete the minikube setup and delete all config:\n",(0,a.kt)("inlineCode",{parentName:"p"},"minikube stop && minikube delete")))),(0,a.kt)("p",null,"Your Mosquitto setup is now running  with a three single mosquitto nodes and the Management Center."),(0,a.kt)("h3",p({},{id:"open-applications-mmc"}),"Open Applications: MMC"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl get nodes -o wide")),(0,a.kt)("li",{parentName:"ul"},"Get the node ip from the above command. This would not same as your host IP as Minikube setups a hypervisor between your host and Kubernetes pods.Usually the IP of minikube is 192.168.49.2, however it is always better to confirm using ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl get nodes -o wide")," command."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},'http://<"node-ip">:31021')," (Open on your browser )"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"Note:")," If MMC is not loading then you can following command:\n",(0,a.kt)("inlineCode",{parentName:"li"},"minikube service mmc -n <namespace>")),(0,a.kt)("li",{parentName:"ul"},"To create a cluster through MMC follow: ",(0,a.kt)("a",p({parentName:"li"},{href:"#create-cluster-in-management-center"}),"these steps"),".")),(0,a.kt)("h3",p({},{id:"connect-to-the-mosquitto"}),"Connect to the Mosquitto"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Make sure you have created the cluster through Management-Center."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"minikube service ha -n <namespace>")),(0,a.kt)("li",{parentName:"ul"},"To subscribe to SYS topics:\n",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto_sub -h <minikube-node-ip> -p 31028 -u <username> -P <password> -t '$SYS/#'"))),(0,a.kt)("h3",p({},{id:"further-useful-commands"}),"Further Useful Commands:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"If you want to change mosquitto.conf, you can do so by uncompressing the helm chart, making the required changes and packaging the helm charts again. The detailed procedure is mentioned below:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"tar -xzvf mosquitto-multi-node-single-host-0.1.0.tgz"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"cd mosquitto-multi-node-single-host/files/")),(0,a.kt)("li",{parentName:"ul"},"Make changes to ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.conf")," and save it."),(0,a.kt)("li",{parentName:"ul"},"Go back to the parent directory:\n",(0,a.kt)("inlineCode",{parentName:"li"},"cd ../")),(0,a.kt)("li",{parentName:"ul"},"Package the helm chart to its original form using:\n",(0,a.kt)("inlineCode",{parentName:"li"},"helm package mosquitto-multi-node-single-host")),(0,a.kt)("li",{parentName:"ul"},"Uninstall helm package\n",(0,a.kt)("inlineCode",{parentName:"li"},"helm uninstall <release-name> -n <namespace>")))),(0,a.kt)("li",{parentName:"ul"},"Reinstall the helm package using the same command you used the first time from the ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-2.8-mmc-2.8-cluster-single-host-kubernetes/kubernetes/multi-node-single-host/")," directory.")))),(0,a.kt)("h2",p({},{id:"create-cluster-in-management-center"}),"Create Cluster in Management Center"),(0,a.kt)("p",null,"After you have completed the installation process, the last step is to configure the Mosquitto HA cluster.\nAccess the Management Center and use the default credentials ",(0,a.kt)("inlineCode",{parentName:"p"},"cedalo")," and password ",(0,a.kt)("inlineCode",{parentName:"p"},"mmcisawesome"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Make sure all three mosquitto nodes are connected in the connection menu. The HA proxy will only connect after the cluster is successfully set up."),(0,a.kt)("li",{parentName:"ul"},"Navigate to ",(0,a.kt)("inlineCode",{parentName:"li"},"Cluster Management")," and click ",(0,a.kt)("inlineCode",{parentName:"li"},"NEW CLUSTER"),"."),(0,a.kt)("li",{parentName:"ul"},"Configure ",(0,a.kt)("inlineCode",{parentName:"li"},"Name"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Description")," and choose between ",(0,a.kt)("inlineCode",{parentName:"li"},"Full-sync")," and ",(0,a.kt)("inlineCode",{parentName:"li"},"Dynamic Security Sync"),"."),(0,a.kt)("li",{parentName:"ul"},"Configure IP address: Instead of private IP address we will use DNS address.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"For node1: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-0.mosquitto.multinode.svc.cluster.local")," and select broker2 from drop-down"),(0,a.kt)("li",{parentName:"ul"},"For node2: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-1.mosquitto.multinode.svc.cluster.local")," and select broker2 from drop-down"),(0,a.kt)("li",{parentName:"ul"},"For node3: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-2.mosquitto.multinode.svc.cluster.local")," and select broker3 from drop-down",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},'Replace "multinode" with your own namespace. If you have used the default one, use the mentioned configurations.'),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-0")," has to be mapped to the mosquitto-1 node in the MMC UI and so on."))))),(0,a.kt)("li",{parentName:"ul"},"Click ",(0,a.kt)("inlineCode",{parentName:"li"},"Save"))),(0,a.kt)("h2",p({},{id:"usage"}),"Usage"),(0,a.kt)("p",null,"Once the installation is complete, you can start using the multi-node Mosquitto broker on your single host. Be sure to check the Mosquitto documentation for further details on configuring and using the broker."))}f.isMDXComponent=!0}}]);