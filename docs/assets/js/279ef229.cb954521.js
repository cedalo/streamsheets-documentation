"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[80191],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=p(n),d=a,k=c["".concat(s,".").concat(d)]||c[d]||u[d]||i;return n?o.createElement(k,r(r({ref:t},m),{},{components:n})):o.createElement(k,r({ref:t},m))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},18533:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>d,default:()=>f,frontMatter:()=>c,metadata:()=>k,toc:()=>h});var o=n(3905),a=Object.defineProperty,i=Object.defineProperties,r=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,n)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&m(e,n,t[n]);if(l)for(var n of l(t))p.call(t,n)&&m(e,n,t[n]);return e};const c={id:"migration",title:"Migration Information",sidebar_label:"Migration Information"},d=void 0,k={unversionedId:"migration",id:"version-3.0/migration",title:"Migration Information",description:"Adding new features can require to adapt the existing configuration of the Pro Mosquitto and MMC setups. This page",source:"@site/mosquitto_versioned_docs/version-3.0/migration.md",sourceDirName:".",slug:"/migration",permalink:"/mosquitto/migration",draft:!1,tags:[],version:"3.0",frontMatter:{id:"migration",title:"Migration Information",sidebar_label:"Migration Information"},sidebar:"someSidebar",previous:{title:"Release Notes",permalink:"/mosquitto/release-notes"},next:{title:"Glossary",permalink:"/mosquitto/glossary"}},g={},h=[{value:"Breaking Changes",id:"breaking-changes",level:3},{value:"Single Node Migration",id:"single-node-migration",level:2},{value:"Re-establish the connection to the Mosquitto broker",id:"re-establish-the-connection-to-the-mosquitto-broker",level:3},{value:"Cluster Migration",id:"cluster-migration",level:2},{value:"Cluster Recreation",id:"cluster-recreation",level:3},{value:"Single Node",id:"single-node",level:2},{value:"Docker Compose",id:"docker-compose",level:3},{value:"Example:",id:"example",level:3},{value:"Cluster setup",id:"cluster-setup",level:2},{value:"Splitting single docker-compose into 3 files for each node and having haproxy before each node (recommended approach)",id:"splitting-single-docker-compose-into-3-files-for-each-node-and-having-haproxy-before-each-node-recommended-approach",level:3},{value:"Leaving everything in a single docker-compose file",id:"leaving-everything-in-a-single-docker-compose-file",level:3},{value:"Features",id:"features",level:2}],N={toc:h};function f(e){var t,n=e,{components:a}=n,m=((e,t)=>{var n={};for(var o in e)s.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&l)for(var o of l(e))t.indexOf(o)<0&&p.call(e,o)&&(n[o]=e[o]);return n})(n,["components"]);return(0,o.kt)("wrapper",(t=u(u({},N),m),i(t,r({components:a,mdxType:"MDXLayout"}))),(0,o.kt)("p",null,"Adding new features can require to adapt the existing configuration of the Pro Mosquitto and MMC setups. This page\ndocuments possible configuration and setup changes. While updating your on-premise setups please refer to this document.\nCloud customers are updated automatically."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Documentation"),": Visit the respective docs to learn how to configure and utilize the new features available in version 2.9. The documentation provides detailed instructions and insights to help you seamlessly integrate these features into your existing setup."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"License Update"),": If your current license does not cover the version features you are upgrading to, it is essential to update your license to access the full capabilities of the new release. The old license will still work for all existing features."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Cluster updates"),": If you are updating a cluster, make sure to update each Mosquitto node one by one, with the leader being the last node to be updated.")),(0,o.kt)("p",null,"Should you encounter any issues during the migration process or if you have any questions regarding the new features or\nlicense updates, please do not hesitate to reach out to us. Our support team is ready to assist you at ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",u({parentName:"strong"},{href:"mailto:support@cedalo.com"}),"support@cedalo.com")),"."),(0,o.kt)("h1",u({},{id:"30-update"}),"3.0 Update"),(0,o.kt)("p",null,"The 3.0 release introduces a completely new UI for the Pro Mosquitto broker and includes some breaking changes. ",(0,o.kt)("strong",{parentName:"p"},"Enterprise customers")," will receive updates in the next release, as essential features are still under development. To ensure a smooth transition, please follow the steps outlined below."),(0,o.kt)("h3",u({},{id:"breaking-changes"}),"Breaking Changes"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Management Center users and user groups must be set up again."),(0,o.kt)("li",{parentName:"ul"},"API Tokens will be introduced in the Enterprise release."),(0,o.kt)("li",{parentName:"ul"},"REST API is currently unavailable."),(0,o.kt)("li",{parentName:"ul"},"Audit trail is currently unavailable."),(0,o.kt)("li",{parentName:"ul"},"Broker connection must be re-established."),(0,o.kt)("li",{parentName:"ul"},"CA certificates are still uploaded to the broker, but are not represented in the UI.")),(0,o.kt)("p",null,"These breaking changes only affect the UI. A full migration of the existing Mosquitto broker is supported."),(0,o.kt)("h2",u({},{id:"single-node-migration"}),"Single Node Migration"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Note admin credentials")," used by the MMC connections to the broker. These are required to connect the broker to the platform."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Download the new 3.0 setup")," and stop the existing installation with ",(0,o.kt)("inlineCode",{parentName:"li"},"docker compose down"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Backup your current setup folder"),"."),(0,o.kt)("li",{parentName:"ol"},"In the new setup directory, copy the ",(0,o.kt)("inlineCode",{parentName:"li"},"platform")," folder, ",(0,o.kt)("inlineCode",{parentName:"li"},"license")," folder, and the new ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," file into your existing setup folder.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"If you have adopted further port bindings, please add them in just copied ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," (e.g. below the ",(0,o.kt)("inlineCode",{parentName:"li"},"mosquitto")," service)."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Optional"),": If you want to keep the old MMC, add the MMC service section to the new ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," file to enable parallel usage of the old and new UIs."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Add the license file")," to the license folder."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Update the ",(0,o.kt)("inlineCode",{parentName:"strong"},"mosquitto.conf")," file")," by adding the new topic tree plugin:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",u({parentName:"pre"},{className:"language-conf"}),"# Topic Tree plugin\nplugin /usr/lib/cedalo_topic_tree.so\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Start the updated setup"),":",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"docker compose up -d\n")),"Run this command at the same level as the docker-compose.yml file.")),(0,o.kt)("h3",u({},{id:"re-establish-the-connection-to-the-mosquitto-broker"}),"Re-establish the connection to the Mosquitto broker"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Open the new Cedalo MQTT Platform UI via ",(0,o.kt)("inlineCode",{parentName:"li"},"localhost:3000"),"."),(0,o.kt)("li",{parentName:"ol"},"Create a new user."),(0,o.kt)("li",{parentName:"ol"},"In the connection edit enter the connection details as configured in the existing MMC connection",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Before saving the changes you can test the connection to the Mosquitto broker by clicking on ",(0,o.kt)("inlineCode",{parentName:"li"},"Test Connection"))))),(0,o.kt)("p",null,"The migration is now complete."),(0,o.kt)("h2",u({},{id:"cluster-migration"}),"Cluster Migration"),(0,o.kt)("p",null,"To migrate a cluster, update ",(0,o.kt)("strong",{parentName:"p"},"one server at a time"),", starting with the two follower nodes. Only copy the ",(0,o.kt)("inlineCode",{parentName:"p"},"platform")," folder if updating the node where the platform is installed."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Download the new 3.0 setup"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Note down admin credentials")," for MMC connections to the broker and your cluster connection details."),(0,o.kt)("li",{parentName:"ol"},"Select a follower node and:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Stop the existing installation with ",(0,o.kt)("inlineCode",{parentName:"li"},"docker compose down"),"."),(0,o.kt)("li",{parentName:"ul"},"Backup the current setup."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Update the docker-compose file"),":",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Locate the ",(0,o.kt)("inlineCode",{parentName:"li"},"mosquitto")," service and update the image to the 3.0 version."),(0,o.kt)("li",{parentName:"ul"},"If this server also runs the Management Center:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Remove the existing ",(0,o.kt)("inlineCode",{parentName:"li"},"management-center")," service and all related settings from the ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml"),".",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Optional"),": To keep it temporarily, change its IP address in ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"ipv4_address: 172.20.4.1"),"."))),(0,o.kt)("li",{parentName:"ul"},"Copy the new ",(0,o.kt)("inlineCode",{parentName:"li"},"platform")," service from the 3.0 setup into the existing ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," file, ensuring the hierarchy is correct. Also copy the ",(0,o.kt)("inlineCode",{parentName:"li"},"platform")," folder from the new setup into the current server folder."),(0,o.kt)("li",{parentName:"ul"},"Delete the current platform database file located at ",(0,o.kt)("inlineCode",{parentName:"li"},"server1/platform/data/mosquitto-platform.sqlite3"),"."))))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Update the ",(0,o.kt)("inlineCode",{parentName:"strong"},"mosquitto.conf")," file")," by adding the new topic tree plugin:",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",u({parentName:"pre"},{className:"language-conf"}),"# Topic Tree plugin\nplugin /usr/lib/cedalo_topic_tree.so\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Start the updated setup"),":",(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",u({parentName:"pre"},{className:"language-bash"}),"docker compose up -d\n")),"After updating the first follower, proceed with the second follower, and finally update the leader node.")),(0,o.kt)("h3",u({},{id:"cluster-recreation"}),"Cluster Recreation"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Open the new Cedalo MQTT Platform UI via ",(0,o.kt)("inlineCode",{parentName:"li"},"localhost:3000"),"."),(0,o.kt)("li",{parentName:"ol"},"Create a new user."),(0,o.kt)("li",{parentName:"ol"},"Enter the connection details of one node as configured in the existing MMC connection.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Upon successful connection, the existing cluster will be detected, and you can automatically add the other nodes."))),(0,o.kt)("li",{parentName:"ol"},"Set the public connection details to reach the cluster, then click ",(0,o.kt)("strong",{parentName:"li"},"Save"),".")),(0,o.kt)("p",null,"The migration is now complete."),(0,o.kt)("h1",u({},{id:"29"}),"2.9"),(0,o.kt)("p",null,"Migration steps for Cedalos Pro Edition of Mosquitto and MMC from version 2.8 to the new version 2.9. We are excited to\nintroduce the enhancements and improvements in this latest release. To ensure a smooth transition, please follow the\nsteps outlined below."),(0,o.kt)("p",null,"Upgrading the existing installation:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"No Additional Environment Variables"),": We have not introduced any new environment variables, nor have we made changes to the setup process itself. Your existing configurations can remain as is."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Docker Image Update Required"),": The primary change involves updating the Docker image for our Cedalo Registry."),(0,o.kt)("li",{parentName:"ul"},"Please update your systems to use the new images:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"For Mosquitto: ",(0,o.kt)("inlineCode",{parentName:"li"},"registry.cedalo.com/mosquitto/mosquitto:2.9")),(0,o.kt)("li",{parentName:"ul"},"For Management Center Premium: ",(0,o.kt)("inlineCode",{parentName:"li"},"registry.cedalo.com/development/management-center-premium:2.9")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Alternative Download Option"),": If you prefer, you can also download the new ",(0,o.kt)("inlineCode",{parentName:"li"},".rpm")," package from our repository for a manual update.")),(0,o.kt)("h1",u({},{id:"28"}),"2.8"),(0,o.kt)("p",null,"Migration steps for upgrading your system from version 2.7 to version 2.8. To ensure a smooth transition, please follow the steps outlined below:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"No Additional Environment Variables"),": We have not introduced any new environment variables, nor have we made changes to the setup process itself. Your existing configurations can remain as is."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Image Update Required"),": The primary change involves updating the image for our Cedalo Registry. Please update your systems to use the new images:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"For Mosquitto: ",(0,o.kt)("inlineCode",{parentName:"li"},"registry.cedalo.com/mosquitto/mosquitto:2.8")),(0,o.kt)("li",{parentName:"ul"},"For Management Center Premium: ",(0,o.kt)("inlineCode",{parentName:"li"},"registry.cedalo.com/development/management-center-premium:2.8")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Alternative Download Option"),": If you prefer, you can also download the new ",(0,o.kt)("inlineCode",{parentName:"li"},".rpm")," package from our repository for a manual update.")),(0,o.kt)("p",null,"Version 2.8 comes with exciting new features designed to enhance your experience and capabilities. To make the most of these new features:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Documentation"),": Visit the respective docs to learn how to configure and utilize the new features available in version 2.8. The documentation provides detailed instructions and insights to help you seamlessly integrate these features into your existing setup."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"License Update"),": If your current license does not cover the version 2.8 features, it is essential to update your license to access the full capabilities of the new release. The old license will still work for all existing features.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Cluster updates"),": If you are updating a cluster, make sure to update each Mosquitto node one by one, with the leader being the last node to be updated."),(0,o.kt)("p",null,"Should you encounter any issues during the migration process or if you have any questions regarding the new features or license updates, please do not hesitate to reach out to us. Our support team is ready to assist you:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Email: ",(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",u({parentName:"strong"},{href:"mailto:support@cedalo.com"}),"support@cedalo.com")))),(0,o.kt)("p",null,"We are committed to ensuring a smooth and efficient upgrade process for all our users. Thank you for choosing our solutions, and we look forward to supporting you through this transition to version 2.8."),(0,o.kt)("h1",u({},{id:"27"}),"2.7"),(0,o.kt)("h2",u({},{id:"single-node"}),"Single Node"),(0,o.kt)("p",null,"This is the Docker Migration guide to upgrade from version 2.6 to 2.7."),(0,o.kt)("h3",u({},{id:"docker-compose"}),"Docker Compose"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Add the following environment variable to the management center:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PROXY_HOST: 0.0.0.0\n")),(0,o.kt)("ol",u({},{start:2}),(0,o.kt)("li",{parentName:"ol"},"You may remove the following variable from the docker-compose as it's no longer being used:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PLUGIN_DIR: /management-center/plugins\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},'Optionally: A new way of loading MMC plugins was added. The file "plugins.json" can now be used to manually configure the plugins. The config.json loads the content of the file on start if the environment variable "CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json" is set. If no file is found an error message is shown and the config.json file will be read. If the file is found, the config.json file plugin list will be overwritten on start.')),(0,o.kt)("p",null,"Specify some specific set of plugins to load via the ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_PLUGIN_LIST_PATH")," environment variable:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),'CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json"\n')),(0,o.kt)("p",null,"You should provide a path to ",(0,o.kt)("inlineCode",{parentName:"p"},"plugins.json")," user data file with the list of plugins to load. It can look like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-json"}),'{\n    "plugins": [\n        {\n            "id": "audit-trail"\n        },\n        {\n            "id": "user-management"\n        },\n        {\n            "id": "cert-management"\n        },\n        {\n            "id": "saml-sso"\n        },\n        {\n            "id": "https"\n        },\n        {\n            "id": "application-tokens"\n        },\n        {\n            "id": "monitoring-rest-api"\n        },\n        {\n            "id": "tls"\n        },\n        {\n            "id": "user-profile-edit"\n        },\n        {\n            "id": "cluster-management"\n        },\n        {\n            "id": "connections-rest-api"\n        },\n        {\n            "id": "custom-themes"\n        },\n        {\n            "id": "multiple-connections"\n        },\n        {\n            "id": "system-status-rest-api"\n        },\n        {\n            "id": "topictree-rest-api"\n        },\n        {\n            "id": "dynamic-security-rest-api"\n        }\n    ]\n}\n')),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Make sure that the ",(0,o.kt)("inlineCode",{parentName:"li"},"command")," section is changed from the following:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"command: >\n    /bin/sh -c \"\n      while ! nc -z mosquitto 1883;\n      do\n        echo 'Waiting for mosquitto';\n        sleep 1;\n      done;\n      cd /management-center; exec /bin/sh /management-center/docker-entrypoint.sh ./start\n    \"\n")),(0,o.kt)("p",null,"to:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"command: >\n    /bin/sh -c \"\n      while ! nc -z mosquitto 1883;\n      do\n        echo 'Waiting for mosquitto';\n        sleep 1;\n      done;\n      cd /management-center; exec ./mmc\n    \"\n")),(0,o.kt)("p",null,"So the line which changes is ",(0,o.kt)("inlineCode",{parentName:"p"},"cd /management-center; exec /bin/sh /management-center/docker-entrypoint.sh ./start")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"cd /management-center; exec ./mmc")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Change MMC image to:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"image: registry.cedalo.com/mosquitto/management-center:2.7\n")),(0,o.kt)("p",null,"and Mosquitto image to:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"image: registry.cedalo.com/mosquitto/mosquitto:2.7\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Place your license to where ",(0,o.kt)("inlineCode",{parentName:"li"},"/management-center/config")," or a different location where ",(0,o.kt)("inlineCode",{parentName:"li"},"CEDALO_MC_LICENSE_PATH")," environment variable is pointing to. For a new license which also covers 2.7 features please contact our team.")),(0,o.kt)("h3",u({},{id:"example"}),"Example:"),(0,o.kt)("p",null,"Here is a sample docker-compose file for 2.7 MMC:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"version: '3.7'\nservices:\n    mosquitto:\n        image: registry.cedalo.com/development/mosquitto:2.7.0-rc1\n        ports:\n            - 1883:1883\n            - 8883:8883\n            - 8090:8090\n        networks:\n            - cedalo-platform\n        environment:\n            CEDALO_LICENSE_FILE: /mosquitto/license/license.lic\n        volumes:\n            - ./mosquitto/config:/mosquitto/config\n            - ./mosquitto/data:/mosquitto/data\n            - ./management-center/config/:/mosquitto/license/\n    management-center:\n        image: registry.cedalo.com/development/management-center-premium:2.7.0-rc1\n        ports:\n            - 8088:8088\n        expose:\n            - 8088\n        depends_on:\n            - mosquitto\n        networks:\n            - cedalo-platform\n        environment:\n            CEDALO_HOST_NAME: ${CEDALO_HOST_NAME}\n            CEDALO_IP_ADDRESS: ${CEDALO_IP_ADDRESS}\n            CEDALO_MC_PROXY_HOST: 0.0.0.0\n            CEDALO_MC_USERNAME: cedalo\n            CEDALO_MC_PASSWORD: mmcisawesome\n            CEDALO_MC_PROXY_SRT_BASE: /management-center/config\n            CEDALO_MC_LICENSE_PATH: /management-center/config/license.lic\n            # CEDALO_MC_PLUGIN_LIST_PATH: /management-center/config/plugins.json\n            CEDALO_MC_PROXY_CONFIG: /management-center/config/config.json\n            CEDALO_MC_PROXY_CONFIG_CERTS: /management-center/config/certs.db\n            CEDALO_MC_PROXY_CONFIG_TOKENS: /management-center/config/tokens.json\n            CEDALO_MC_PROXY_CONFIG_USERS: /management-center/config/users.json\n            CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL: /management-center/config/audit.json\n            CEDALO_MC_BROKER_CONNECTION_MQTT_EXISTS_MAPPING: mosquitto:true\n            CEDALO_MC_BROKER_CONNECTION_MQTTS_EXISTS_MAPPING: mosquitto:false\n            CEDALO_MC_BROKER_CONNECTION_WS_EXISTS_MAPPING: mosquitto:false\n            CEDALO_MC_BROKER_CONNECTION_HOST_MAPPING: mosquitto:localhost\n            CEDALO_MC_DATA_DIRECTORY_PATH: /management-center/config\n            CEDALO_MC_MODE: offline\n        volumes:\n            - ./management-center/config:/management-center/config\n            # map unix socket for audit trail:\n            - /dev/log:/dev/log\n        command: >\n            /bin/sh -c \"\n              while ! nc -z mosquitto 1883;\n              do\n                echo 'Waiting for mosquitto';\n                sleep 1;\n              done;\n              cd /management-center; exec ./mmc\n            \"\nnetworks:\n    cedalo-platform:\n        name: cedalo-platform\n        driver: bridge\n")),(0,o.kt)("h2",u({},{id:"cluster-setup"}),"Cluster setup"),(0,o.kt)("p",null,"This is the Docker Migration guide to upgrade your cluster setup from version 2.6 to 2.7."),(0,o.kt)("p",null,"There are currently two variants of migrating the setup:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#30-update"}),"3.0 Update"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#breaking-changes"}),"Breaking Changes")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#single-node-migration"}),"Single Node Migration")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#cluster-migration"}),"Cluster Migration"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#cluster-recreation"}),"Cluster Recreation")))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#29"}),"2.9")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#28"}),"2.8")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#27"}),"2.7"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#single-node"}),"Single Node"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#docker-compose"}),"Docker Compose")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#example"}),"Example:")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#cluster-setup"}),"Cluster setup"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#splitting-single-docker-compose-into-3-files-for-each-node-and-having-haproxy-before-each-node-recommended-approach"}),"Splitting single docker-compose into 3 files for each node and having haproxy before each node (recommended approach)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#leaving-everything-in-a-single-docker-compose-file"}),"Leaving everything in a single docker-compose file")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",u({parentName:"li"},{href:"#features"}),"Features"))))),(0,o.kt)("h3",u({},{id:"splitting-single-docker-compose-into-3-files-for-each-node-and-having-haproxy-before-each-node-recommended-approach"}),"Splitting single docker-compose into 3 files for each node and having haproxy before each node (recommended approach)"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create the following directory structure:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{}),"setup_directory/\n|\n|----\x3eserver1/\n|        |\n|        |----\x3ehaproxy/\n|        |\n|        |----\x3elicense\n|        |\n|        |----\x3emanagement-center/config\n|        |\n|        |----\x3emosquitto\n|               |\n|               |----\x3econfig/\n|               |\n|               |----\x3edata/ha/\n|\n|----\x3eserver2/\n|        |\n|        |----\x3ehaproxy/\n|        |\n|        |----\x3elicense\n|        |\n|        |----\x3emosquitto\n|               |\n|               |----\x3econfig/\n|               |\n|               |----\x3edata/ha/\n|\n|----\x3eserver3/\n|        |\n|        |----\x3ehaproxy/\n|        |\n|        |----\x3elicense\n|        |\n|        |----\x3emosquitto\n|               |\n|               |----\x3econfig/\n|               |\n|               |----\x3edata/ha/\n")),(0,o.kt)("ol",u({},{start:2}),(0,o.kt)("li",{parentName:"ol"},"Move the contents of your old setup's ",(0,o.kt)("inlineCode",{parentName:"li"},"haproxy")," folder into:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server1/haproxy/"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server2/haproxy/"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server3/haproxy/")))),(0,o.kt)("ol",u({},{start:3}),(0,o.kt)("li",{parentName:"ol"},"Move the contents of your old setups's ",(0,o.kt)("inlineCode",{parentName:"li"},"mosquitto1"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"mosquitto2"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"mosquitto3")," folders into:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server1/mosquitto/"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server2/mosquitto/"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server3/mosquitto/")))),(0,o.kt)("p",null,"respectively."),(0,o.kt)("ol",u({},{start:4}),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Move the contents of your old setup's ",(0,o.kt)("inlineCode",{parentName:"p"},"management-center/config")," folder into ",(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/management-center/config/"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add your license or move an old one from ",(0,o.kt)("inlineCode",{parentName:"p"},"management-center/config")," (or ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto1/license"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto2/license"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto3/license"),") to:"))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server1/license/"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server2/license/"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server3/license/")))),(0,o.kt)("admonition",u({},{type:"info"}),(0,o.kt)("p",{parentName:"admonition"},"All three locations should contain the same license.")),(0,o.kt)("ol",u({},{start:6}),(0,o.kt)("li",{parentName:"ol"},"Add the following ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"setup_directory/server1"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"version: '3.7'\n\nservices:\n    mosquitto:\n        image: registry.cedalo.com/mosquitto/mosquitto:2.7\n        volumes:\n            - ./mosquitto/config:/mosquitto/config\n            - ./mosquitto/data:/mosquitto/data\n            - ./license:/mosquitto/license:ro\n        hostname: mosquitto1\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.1.1\n        environment:\n            CEDALO_LICENSE_FILE: /mosquitto/license/license.lic\n            MOSQUITTO_DYNSEC_PASSWORD: 1LD1RGNgFu1u4tfasOh1j7vOrCLhMVq0\n        restart: unless-stopped\n    haproxy:\n        image: haproxy:2.7\n        ports:\n            - 127.0.0.1:1883:1883 # change binding 127.0.0.1:1883 to public IPv4 X.Y.Z:1883\n        volumes:\n            - ./haproxy:/usr/local/etc/haproxy:ro\n        restart: unless-stopped\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.2.1\n    management-center:\n        image: registry.cedalo.com/mosquitto/management-center:2.7\n        environment:\n            CEDALO_HOST_NAME: ${CEDALO_HOST_NAME}\n            CEDALO_IP_ADDRESS: ${CEDALO_IP_ADDRESS}\n            CEDALO_MC_PROXY_HOST: 0.0.0.0\n\n            CEDALO_MC_USERNAME: cedalo\n            CEDALO_MC_PASSWORD: mmcisawesome\n\n            CEDALO_MC_PROXY_SRT_BASE: /management-center/config\n            CEDALO_MC_LICENSE_PATH: /management-center/license/license.lic\n\n            CEDALO_MC_PLUGIN_LIST_PATH: /management-center/config/plugins.json\n            CEDALO_MC_PROXY_CONFIG: /management-center/config/config.json\n            CEDALO_MC_PROXY_CONFIG_CERTS: /management-center/config/certs.db\n            CEDALO_MC_PROXY_CONFIG_TOKENS: /management-center/config/tokens.json\n            CEDALO_MC_PROXY_CONFIG_USERS: /management-center/config/users.json\n            CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL: /management-center/config/audit.json\n            CEDALO_MC_PROXY_CONFIG_CLUSTERS: /management-center/config/clusters.json\n            CEDALO_MC_BROKER_CONNECTION_MQTT_EXISTS_MAPPING: mosquitto:true\n            CEDALO_MC_BROKER_CONNECTION_MQTTS_EXISTS_MAPPING: mosquitto:false\n            CEDALO_MC_BROKER_CONNECTION_WS_EXISTS_MAPPING: mosquitto:false\n            CEDALO_MC_BROKER_CONNECTION_HOST_MAPPING: mosquitto:localhost\n\n            CEDALO_MC_DATA_DIRECTORY_PATH: /management-center/config\n\n            CEDALO_MC_MODE: offline\n        ports:\n            - 127.0.0.1:8088:8088\n        volumes:\n            - ./management-center/config:/management-center/config\n            - ./license:/management-center/license\n            # map unix socket for audit trail:\n            - /dev/log:/dev/log\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.3.1\n        restart: unless-stopped\nnetworks:\n    mosquitto:\n        name: mosquitto\n        ipam:\n            driver: default\n            config:\n                - subnet: 172.20.0.0/16\n")),(0,o.kt)("p",null,"Or adapt your existing ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," from the old setup to be similar to the above."),(0,o.kt)("p",null,"In this case, make sure that:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"In ",(0,o.kt)("inlineCode",{parentName:"li"},"services")," section make sure that only ",(0,o.kt)("inlineCode",{parentName:"li"},"mosquitto1")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"haproxy"),", and ",(0,o.kt)("inlineCode",{parentName:"li"},"management-center")," remain.")),(0,o.kt)("p",null,"Now, rename ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto1")," service into ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Change mosquitto image to ",(0,o.kt)("inlineCode",{parentName:"p"},"registry.cedalo.com/mosquitto/mosquitto:2.7")," and MMC to ",(0,o.kt)("inlineCode",{parentName:"p"},"registry.cedalo.com/mosquitto/management-center:2.7"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Make sure ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto")," service has the following ",(0,o.kt)("inlineCode",{parentName:"p"},"hostname")," section:"))),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"hostname: mosquitto1\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Update ",(0,o.kt)("inlineCode",{parentName:"p"},"management-center/networks/mosquitto/ipv4_address")," value and set it to ",(0,o.kt)("inlineCode",{parentName:"p"},"172.20.3.1"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Make sure that mosquitto volumes have correct paths. For instance:"))),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"volumes:\n    - ./mosquitto/config:/mosquitto/config\n    - ./mosquitto/data:/mosquitto/data\n    - ./license:/mosquitto/license:ro\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add the following environment variable:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PROXY_HOST: 0.0.0.0\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Make sure you have ",(0,o.kt)("inlineCode",{parentName:"li"},"CEDALO_MC_PROXY_CONFIG_CLUSTERS")," from your old setup.")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PROXY_CONFIG_CLUSTERS: /management-center/config/clusters.json\n")),(0,o.kt)("p",null,"Technically, you don't need to explicitly define it as long as you set ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_DATA_DIRECTORY_PATH")," (because in this case ",(0,o.kt)("inlineCode",{parentName:"p"},"clusters.json")," will be looked up in ",(0,o.kt)("inlineCode",{parentName:"p"},"$CEDALO_MC_PROXY_CONFIG_CLUSTERS/clusters.json"),"), but it's still a good idea to mention it explicitly, especially if you had ",(0,o.kt)("inlineCode",{parentName:"p"},"clusters.json")," stored in a non-default location."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you are going to use Audit Trail, add the following variables:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_HOST_NAME: ${CEDALO_HOST_NAME}\nCEDALO_IP_ADDRESS: ${CEDALO_IP_ADDRESS}\n\nCEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL: /management-center/config/audit.json\n")),(0,o.kt)("p",null,"Note that if you have ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_DATA_DIRECTORY_PATH")," specified, you don't have to set ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL")," as well, but specifying it explicitely is a good idea."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_HOST_NAME")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_IP_ADDRESS")," should be provided before running ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," (they will be automatically set when running with ",(0,o.kt)("inlineCode",{parentName:"p"},"start.sh")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"start.bat"),"). These variables will display hostname and ip address of the mmc application in the syslog entries."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you want to use audit-trail and you should additionally specify the following mount if you want your container to direct the syslogs into the hostmachine's ",(0,o.kt)("inlineCode",{parentName:"li"},"/dev/log")," unix socket:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"volumes:\n    # other volumes here...\n    - /dev/log:/dev/log\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"You may remove the following variable from the docker-compose as it's no longer being used:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PLUGIN_DIR: /management-center/plugins\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Optionally: A new way of loading MMC plugins was added. The file "plugins.json" can now be used to manually configure the plugins. The config.json loads the content of the file on start if the environment variable "CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json" is set. If no file is found an error message is shown and the config.json file will be read. If the file is found, the config.json file plugin list will be overwritten on start.')),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),'CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json"\n')),(0,o.kt)("p",null,"You should provide a path to ",(0,o.kt)("inlineCode",{parentName:"p"},"plugins.json")," user data file with the list of plugins to load. It can look like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-json"}),'{\n    "plugins": [\n        {\n            "id": "audit-trail"\n        },\n        {\n            "id": "user-management"\n        },\n        {\n            "id": "cert-management"\n        },\n        {\n            "id": "saml-sso"\n        },\n        {\n            "id": "https"\n        },\n        {\n            "id": "application-tokens"\n        },\n        {\n            "id": "monitoring-rest-api"\n        },\n        {\n            "id": "tls"\n        },\n        {\n            "id": "user-profile-edit"\n        },\n        {\n            "id": "cluster-management"\n        },\n        {\n            "id": "connections-rest-api"\n        },\n        {\n            "id": "custom-themes"\n        },\n        {\n            "id": "multiple-connections"\n        },\n        {\n            "id": "system-status-rest-api"\n        },\n        {\n            "id": "topictree-rest-api"\n        },\n        {\n            "id": "dynamic-security-rest-api"\n        }\n    ]\n}\n')),(0,o.kt)("admonition",u({},{type:"info"}),(0,o.kt)("p",{parentName:"admonition"},"Adapt other environment variables according to what you had in your old setup.")),(0,o.kt)("ol",u({},{start:7}),(0,o.kt)("li",{parentName:"ol"},"Add the following ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"setup_directory/server2"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"version: '3.7'\n\nservices:\n    mosquitto:\n        image: registry.cedalo.com/mosquitto/mosquitto:2.7\n        volumes:\n            - ./mosquitto/config:/mosquitto/config\n            - ./mosquitto/data:/mosquitto/data\n            - ./license:/mosquitto/license:ro\n        hostname: mosquitto2\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.1.2\n        environment:\n            CEDALO_LICENSE_FILE: /mosquitto/license/license.lic\n            MOSQUITTO_DYNSEC_PASSWORD: 1LD1RGNgFu1u4tfasOh1j7vOrCLhMVq0\n        restart: unless-stopped\n    haproxy:\n        image: haproxy:2.7\n        ports:\n            - 127.0.0.1:1884:1883 # change binding 127.0.0.1:1884 to public IPv4 X.Y.Z:1883\n        volumes:\n            - ./haproxy:/usr/local/etc/haproxy:ro\n        restart: unless-stopped\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.2.2\nnetworks:\n    mosquitto:\n        name: mosquitto\n        ipam:\n            driver: default\n            config:\n                - subnet: 172.20.0.0/16\n")),(0,o.kt)("p",null,"Or adapt your existing ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," from the old setup such that it contains only ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto2")," service renamed to ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"haproxy"),"."),(0,o.kt)("p",null,"Make sure that ",(0,o.kt)("inlineCode",{parentName:"p"},"haproxy/networks/mosquitto/ipv4_address")," is set to ",(0,o.kt)("inlineCode",{parentName:"p"},"172.20.2.2")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto/networks/mosquitto/ipv4_address")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"172.20.1.2"),"."),(0,o.kt)("p",null,"Also make sure that the image is set to ",(0,o.kt)("inlineCode",{parentName:"p"},"registry.cedalo.com/mosquitto/mosquitto:2.7"),"."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto/hostname")," should equal ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto2"),"."),(0,o.kt)("p",null,"Additionally, don't forget to doublecheck that paths in ",(0,o.kt)("inlineCode",{parentName:"p"},"volumes")," section are correct."),(0,o.kt)("ol",u({},{start:8}),(0,o.kt)("li",{parentName:"ol"},"Add the following ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"setup_directory/server3"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"version: '3.7'\n\nservices:\n    mosquitto:\n        image: registry.cedalo.com/mosquitto/mosquitto:2.7\n        volumes:\n            - ./mosquitto/config:/mosquitto/config\n            - ./mosquitto/data:/mosquitto/data\n            - ./license:/mosquitto/license:ro\n        hostname: mosquitto3\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.1.3\n        environment:\n            CEDALO_LICENSE_FILE: /mosquitto/license/license.lic\n            MOSQUITTO_DYNSEC_PASSWORD: 1LD1RGNgFu1u4tfasOh1j7vOrCLhMVq0\n        restart: unless-stopped\n    haproxy:\n        image: haproxy:2.7\n        ports:\n            - 127.0.0.1:1885:1883 # change binding 127.0.0.1:1885 to public IPv4 X.Y.Z:1883\n        volumes:\n            - ./haproxy:/usr/local/etc/haproxy:ro\n        restart: unless-stopped\n        networks:\n            mosquitto:\n                ipv4_address: 172.20.2.3\nnetworks:\n    mosquitto:\n        name: mosquitto\n        ipam:\n            driver: default\n            config:\n                - subnet: 172.20.0.0/16\n")),(0,o.kt)("p",null,"It's basically the same as the ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," for ",(0,o.kt)("inlineCode",{parentName:"p"},"setup_directory/server3")," but has ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto/hostname")," set to ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto3"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto/networks/mosquitto/ipv4_address")," set to ",(0,o.kt)("inlineCode",{parentName:"p"},"172.20.1.3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"haproxy/networks/mosquitto/ipv4_address")," equal to ",(0,o.kt)("inlineCode",{parentName:"p"},"172.20.2.3"),"."),(0,o.kt)("ol",u({},{start:9}),(0,o.kt)("li",{parentName:"ol"},"You can start your setup now with the following sh script or similar by issuing ",(0,o.kt)("inlineCode",{parentName:"li"},"path_to_script.sh up -d"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-sh"}),'#!/usr/bin/env bash\n\nDIR_PATH="$(cd "$(dirname "$0")"; pwd)"\n\nCMD="${@:-up}"\n\ndocker-compose -f "$DIR_PATH/server1/docker-compose.yml" $CMD\ndocker-compose -f "$DIR_PATH/server2/docker-compose.yml" $CMD\ndocker-compose -f "$DIR_PATH/server3/docker-compose.yml" $CMD\n')),(0,o.kt)("p",null,"for Windows (",(0,o.kt)("inlineCode",{parentName:"p"},"path_to_script.bat up -d"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-bat"}),'@echo off\n\nSET CMD=%*\nIF ["%CMD%"] == [""] set CMD=up\n\ndocker-compose -f "%~dp0server1\\docker-compose.yml" %CMD%\ndocker-compose -f "%~dp0server2\\docker-compose.yml" %CMD%\ndocker-compose -f "%~dp0server3\\docker-compose.yml" %CMD%\n')),(0,o.kt)("h3",u({},{id:"leaving-everything-in-a-single-docker-compose-file"}),"Leaving everything in a single docker-compose file"),(0,o.kt)("p",null,"If you want to leave everything similar to the old setups and use a single ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose.yml")," file than make sure to make the following changes to this file to upgrade to 2.7."),(0,o.kt)("p",null,"Note that in the future we will not support this setup and will not provide migration guides for a single `docker-compose.yml`` file."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Change mosquitto images to ",(0,o.kt)("inlineCode",{parentName:"p"},"registry.cedalo.com/mosquitto/mosquitto:2.7"),". Change MMC image to ",(0,o.kt)("inlineCode",{parentName:"p"},"registry.cedalo.com/mosquitto/management-center:2.7"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Update your licenses in ",(0,o.kt)("inlineCode",{parentName:"p"},"management-center/config"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto1/license"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto2/license"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"mosquitto3/license"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add the following environment variable:"))),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PROXY_HOST: 0.0.0.0\n")),(0,o.kt)("ol",u({},{start:4}),(0,o.kt)("li",{parentName:"ol"},"Make sure you have ",(0,o.kt)("inlineCode",{parentName:"li"},"CEDALO_MC_PROXY_CONFIG_CLUSTERS")," from your old setup.")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PROXY_CONFIG_CLUSTERS: /management-center/config/clusters.json\n")),(0,o.kt)("p",null,"Technically, you don't need to explicitly define it as long as you set ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_DATA_DIRECTORY_PATH")," (because in this case ",(0,o.kt)("inlineCode",{parentName:"p"},"clusters.json")," will be looked up in ",(0,o.kt)("inlineCode",{parentName:"p"},"$CEDALO_MC_PROXY_CONFIG_CLUSTERS/clusters.json"),"), but it's still a good idea to mention it explicitly, especially if you had ",(0,o.kt)("inlineCode",{parentName:"p"},"clusters.json")," stored in a non-default location."),(0,o.kt)("ol",u({},{start:5}),(0,o.kt)("li",{parentName:"ol"},"If you are going to use Audit Trail, add the following variables:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_HOST_NAME: ${CEDALO_HOST_NAME}\nCEDALO_IP_ADDRESS: ${CEDALO_IP_ADDRESS}\n\nCEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL: /management-center/config/audit.json\n")),(0,o.kt)("p",null,"Note that if you have ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_DATA_DIRECTORY_PATH")," specified, you don't have to set ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_MC_PROXY_CONFIG_AUDIT_TRAIL")," as well, but specifying it explicitely is a good idea."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_HOST_NAME")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"CEDALO_IP_ADDRESS")," should be provided before running ",(0,o.kt)("inlineCode",{parentName:"p"},"docker-compose")," (they will be automatically set when running with ",(0,o.kt)("inlineCode",{parentName:"p"},"start.sh")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"start.bat"),"). These variables will display hostname and ip address of the mmc application in the syslog entries."),(0,o.kt)("ol",u({},{start:6}),(0,o.kt)("li",{parentName:"ol"},"If you want to use audit-trail you should additionally specify the following mount if you want your container to direct the syslogs into the hostmachine's ",(0,o.kt)("inlineCode",{parentName:"li"},"/dev/log")," unix socket:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"volumes:\n    # other volumes here...\n    - /dev/log:/dev/log\n")),(0,o.kt)("ol",u({},{start:7}),(0,o.kt)("li",{parentName:"ol"},"You may remove the following variable from the docker-compose as it's no longer being used:")),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),"CEDALO_MC_PLUGIN_DIR: /management-center/plugins\n")),(0,o.kt)("ol",u({},{start:8}),(0,o.kt)("li",{parentName:"ol"},'Optionally: A new way of loading MMC plugins was added. The file "plugins.json" can now be used to manually configure the plugins. The config.json loads the content of the file on start if the environment variable "CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json" is set. If no file is found an error message is shown and the config.json file will be read. If the file is found, the config.json file plugin list will be overwritten on start.')),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-yml"}),'CEDALO_MC_PLUGIN_LIST_PATH: management-center/config/plugins.json"\n')),(0,o.kt)("p",null,"You should provide a path to ",(0,o.kt)("inlineCode",{parentName:"p"},"plugins.json")," user data file with the list of plugins to load. It can look like the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",u({parentName:"pre"},{className:"language-json"}),'{\n    "plugins": [\n        {\n            "id": "audit-trail"\n        },\n        {\n            "id": "user-management"\n        },\n        {\n            "id": "cert-management"\n        },\n        {\n            "id": "saml-sso"\n        },\n        {\n            "id": "https"\n        },\n        {\n            "id": "application-tokens"\n        },\n        {\n            "id": "monitoring-rest-api"\n        },\n        {\n            "id": "tls"\n        },\n        {\n            "id": "user-profile-edit"\n        },\n        {\n            "id": "cluster-management"\n        },\n        {\n            "id": "connections-rest-api"\n        },\n        {\n            "id": "custom-themes"\n        },\n        {\n            "id": "multiple-connections"\n        },\n        {\n            "id": "system-status-rest-api"\n        },\n        {\n            "id": "topictree-rest-api"\n        },\n        {\n            "id": "dynamic-security-rest-api"\n        }\n    ]\n}\n')),(0,o.kt)("admonition",u({},{type:"info"}),(0,o.kt)("p",{parentName:"admonition"},"Adapt other environment variables according to what you had in your old setup.")),(0,o.kt)("ol",u({},{start:9}),(0,o.kt)("li",{parentName:"ol"},"Start your setup as before with start scripts or ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose up -d"))),(0,o.kt)("h2",u({},{id:"features"}),"Features"),(0,o.kt)("p",null,"The new version added new features, which are not active by default. As usual, features are implemented via plugins, which can be turned off and on in the configuration files of the Management Center and Mosquitto. Loading plugins, which are not used can increase resources needed. This is why certain plugins need activation. To active new 2.7 features please see their documentation."))}f.isMDXComponent=!0}}]);