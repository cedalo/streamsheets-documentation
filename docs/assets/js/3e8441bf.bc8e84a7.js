"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[54439],{83166:(e,t,s)=>{var n=s(64836);t.Z=void 0;var i=n(s(64938)),r=s(85893),a=(0,i.default)((0,r.jsx)("path",{d:"M12 2 4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3zm-1.06 13.54L7.4 12l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41-5.64 5.66z"}),"GppGood");t.Z=a},38165:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>h,contentTitle:()=>g,default:()=>v,frontMatter:()=>p,metadata:()=>f,toc:()=>b});var n=s(3905),i=s(49044),r=Object.defineProperty,a=Object.defineProperties,o=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,d=(e,t,s)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,m=(e,t)=>{for(var s in t||(t={}))l.call(t,s)&&d(e,s,t[s]);if(u)for(var s of u(t))c.call(t,s)&&d(e,s,t[s]);return e};const p={id:"persistent-queueing",title:"Persistent Queueing",sidebar_label:"Persistent Queueing"},g=void 0,f={unversionedId:"advanced-features/persistent-queueing",id:"version-3.1/advanced-features/persistent-queueing",title:"Persistent Queueing",description:"In several use cases of an MQTT Message Broker the broker has to deal with unstable or unreliable connectivity.",source:"@site/mosquitto_versioned_docs/version-3.1/advanced-features/persistent-queueing.md",sourceDirName:"advanced-features",slug:"/advanced-features/persistent-queueing",permalink:"/mosquitto/advanced-features/persistent-queueing",draft:!1,tags:[],version:"3.1",frontMatter:{id:"persistent-queueing",title:"Persistent Queueing",sidebar_label:"Persistent Queueing"},sidebar:"someSidebar",previous:{title:"Data Validation",permalink:"/mosquitto/advanced-features/data-validation"},next:{title:"Persistent Ensured QoS1/QoS2 Message Handling",permalink:"/mosquitto/advanced-features/persistent-message-handling"}},h={},b=[{value:"Memory message queue",id:"memory-message-queue",level:2},{value:"Persistent message queue",id:"persistent-message-queue",level:2}],y={toc:b};function v(e){var t,s=e,{components:r}=s,d=((e,t)=>{var s={};for(var n in e)l.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&u)for(var n of u(e))t.indexOf(n)<0&&c.call(e,n)&&(s[n]=e[n]);return s})(s,["components"]);return(0,n.kt)("wrapper",(t=m(m({},y),d),a(t,o({components:r,mdxType:"MDXLayout"}))),(0,n.kt)(i.Z,{mdxType:"PremiumFeature"}),(0,n.kt)("p",null,"In several use cases of an MQTT Message Broker the broker has to deal with unstable or unreliable connectivity.\nSometimes clients may get disconnected quite frequently and/or reconnect after a significant amount of time.\nThis very often happens with moving assets, which have an unreliable mobile network connectivity.\nOr especially in federated broker setups some broker maybe offline for a longer period of time.\nThe Cedalo Persistent Queue feature will help to deal with such scenarios when larger amount of messages need to be\nstored for either the persistent clients being offline or broker bridge connection not being able to send out\ndata."),(0,n.kt)("h2",m({},{id:"memory-message-queue"}),"Memory message queue"),(0,n.kt)("p",null,"The Eclipse Mosquitto broker supports the queuing of messages for clients that are persistently connected but temporarily offline. This functionality extends to outgoing MQTT bridge connections, holding messages in a queue until the target broker becomes available. These queued messages are stored in memory for all persistent connections that are offline. To ensure data integrity, messages are also backed up in a persistence store through the use of a persistence plugin, such as the Persist SQLite plugin. However, the capacity for queued messages is inherently constrained by the broker's available main memory. This limitation can become apparent in scenarios with high message volumes or prolonged network outages."),(0,n.kt)("p",null,"In Pro Mosquitto it is possible to avoid a crash of the broker due to memory exhaustion. The user may limit the number of messages, which will be queued for a single client or a single outgoing bridge connection by using the config entry ",(0,n.kt)("inlineCode",{parentName:"p"},"max_queued_messages"),"."),(0,n.kt)("p",null,"If the broker is stopped and restarted with queued messages for one of multiple connections all messages will be restored from the\npersistence store before the broker will start its operation."),(0,n.kt)("h2",m({},{id:"persistent-message-queue"}),"Persistent message queue"),(0,n.kt)("p",null,"The introduction of the Cedalo Persistent Queue feature liberates users from the constraints of main memory for storing messages for offline connections. By configuring the ",(0,n.kt)("inlineCode",{parentName:"p"},"max_persist_queued_messages")," setting, users can specify the number of messages to be queued on disk per client, enabling a reduction in the ",(0,n.kt)("inlineCode",{parentName:"p"},"max_queued_messages")," setting and consequently, the memory footprint."),(0,n.kt)("p",null,"To leverage the persistent queue functionality, a compatible persistence plugin must be configured. Initially, only the Persistent SQLite store supports the Cedalo Persistent Queue feature."),(0,n.kt)("p",null,"Upon restarting, if the broker faces a large volume of queued messages for one or more clients, it will load only the necessary messages into memory and keep the remainder on disk. This approach significantly enhances the restart process for brokers managing extensive message queues."),(0,n.kt)("p",null,"The availability and capacity of the persistent queue may vary based on your license. License details, including features and expiration dates, can be found in the broker log, indicated by entries such as:"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"License: Feature persist-queued-messages: 1000000 AVAILABLE until 2024-05-02T15:53:46.")))}v.isMDXComponent=!0},49044:(e,t,s)=>{s.d(t,{Z:()=>o});var n=s(67294),i=s(39082),r=s(62659),a=s(83166);function o({inline:e}){return n.createElement(i.Z,{sx:{margin:e?"0px 5px":"0px 5px 5px 10px",height:e?"22px":void 0,color:"#ffffff",backgroundColor:r.Z[500]},size:"small",icon:n.createElement(a.Z,{style:{color:"white"},size:"small"}),label:"Premium"})}}}]);