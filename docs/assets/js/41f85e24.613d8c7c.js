"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[60350],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var i=a(67294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=i.createContext({}),c=function(e){var t=i.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(a),m=n,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||r;return a?i.createElement(h,o(o({ref:t},p),{},{components:a})):i.createElement(h,o({ref:t},p))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,o=new Array(r);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var c=2;c<r;c++)o[c]=a[c];return i.createElement.apply(null,o)}return i.createElement.apply(null,a)}d.displayName="MDXCreateElement"},33660:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>f,contentTitle:()=>m,default:()=>k,frontMatter:()=>d,metadata:()=>h,toc:()=>y});var i=a(3905),n=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,p=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,u=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&p(e,a,t[a]);if(s)for(var a of s(t))c.call(t,a)&&p(e,a,t[a]);return e};const d={id:"platform-ldap-auth",title:"LDAP Authentication/SSO",sidebar_label:"LDAP Authentication/SSO"},m=void 0,h={unversionedId:"security/platform-access/platform-ldap-auth",id:"version-3.0/security/platform-access/platform-ldap-auth",title:"LDAP Authentication/SSO",description:"This feature is only available in the enterprise version.",source:"@site/mosquitto_versioned_docs/version-3.0/security/platform-access/platform-ldap-auth.md",sourceDirName:"security/platform-access",slug:"/security/platform-access/platform-ldap-auth",permalink:"/mosquitto/security/platform-access/platform-ldap-auth",draft:!1,tags:[],version:"3.0",frontMatter:{id:"platform-ldap-auth",title:"LDAP Authentication/SSO",sidebar_label:"LDAP Authentication/SSO"},sidebar:"someSidebar",previous:{title:"API Tokens",permalink:"/mosquitto/security/platform-access/api-tokens"},next:{title:"OIDC Authentication/SSO",permalink:"/mosquitto/security/platform-access/platform-oidc-auth"}},f={},y=[{value:"LDAP SSO (single sign-on)",id:"ldap-sso-single-sign-on",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Limitations",id:"limitations",level:3}],N={toc:y};function k(e){var t,a=e,{components:n}=a,p=((e,t)=>{var a={};for(var i in e)l.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&s)for(var i of s(e))t.indexOf(i)<0&&c.call(e,i)&&(a[i]=e[i]);return a})(a,["components"]);return(0,i.kt)("wrapper",(t=u(u({},N),p),r(t,o({components:n,mdxType:"MDXLayout"}))),(0,i.kt)("admonition",u({},{type:"note"}),(0,i.kt)("p",{parentName:"admonition"},"This feature is only available in the enterprise version.")),(0,i.kt)("h2",u({},{id:"ldap-sso-single-sign-on"}),"LDAP SSO (single sign-on)"),(0,i.kt)("p",null,"LDAP authentication/SSO feature allows Mosquitto MQTT Platform users to authenticate into the application using their corporate directory information service (LDAP) such as Active Directory. This allows for Platform's interoperability with existing user pfofiles within the organisation."),(0,i.kt)("p",null,"This feature can be configured by specifying several environment variables detailed in the ",(0,i.kt)("a",u({parentName:"p"},{href:"#configuration"}),"configuration section")," below."),(0,i.kt)("h3",u({},{id:"terminology"}),"Terminology"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Directory service (or directory information service) - A hierarchical database system that stores and organizes information about network resources, users, and other objects in a centralized location."),(0,i.kt)("li",{parentName:"ul"},"Active Directory - Microsoft's implementation of the active directory service commonly used in corporate organisations. Other implementations are: OpenLDAP, 389 Directory Serverm Apache Directory Server etc."),(0,i.kt)("li",{parentName:"ul"},"LDAP (Lightweight Directory Access Protocol) - A protocol for accessing and managing directory information services. It facilitates a unified access to user information for enabling single sign-on (SSO) capabilities across different applications. In this documentation the name of the protocol is used interchangably with directory information service."),(0,i.kt)("li",{parentName:"ul"},"DN - Distinguished Name. It is a string that uniquely identifies an entry (such as a user, group, or other objects) in the LDAP directory hierarchy. An example of a DN would be: ",(0,i.kt)("inlineCode",{parentName:"li"},"CN=John Doe,OU=Users,DC=example,DC=com"),"."),(0,i.kt)("li",{parentName:"ul"},"LDAP record (or LDAP entry) - a record in the directory service database that holds a collection of information about an entity such as user, network resource etc. Each entry contains a distinguished name (DN), a set of attriiibutes, and a one or more object classes that define what attributes are required and allowed for that entry.")),(0,i.kt)("h3",u({},{id:"configuration"}),"Configuration"),(0,i.kt)("p",null,"Before configuring LDAP SSO, you should first know what is being used as a primary identifier of a LDAP user in your system. By default a full distinguished name is assumed to be an identifier but for ease of use many organisations define a unique LDAP record attribute such as ",(0,i.kt)("inlineCode",{parentName:"p"},"mail")," (email) and use it to uniquely identify a user. This identifier is what's being accepted by the ",(0,i.kt)("inlineCode",{parentName:"p"},"username")," field on the login and sign up pages of the Platform. If you are not using full DN as an identifer, then a separate administrative user with search privileges as well as a filter criteria have to be supplied to be able to perform search requests on the directory service. These search requests are used to find a corresponding user record's DN when binding user to the directory service. More details are explained below."),(0,i.kt)("p",null,"It's recommended (but not required) to start with a clean Platform that doesn't have any users. You can delete ",(0,i.kt)("inlineCode",{parentName:"p"},"mosquitto-enterprise.sqlite3")," file to achieve this and restart the platform. The file is stored in the data directory which depends on your installation, but in Docker environments it's usually called ",(0,i.kt)("inlineCode",{parentName:"p"},"data"),", while for an RPM-package it's located under ",(0,i.kt)("inlineCode",{parentName:"p"},"var/opt/cedalo/mosquitto-platform"),". You can also manually delete your users as an administrator or by signing in one user at a time and navigating to ",(0,i.kt)("inlineCode",{parentName:"p"},"Settings")," -> ",(0,i.kt)("inlineCode",{parentName:"p"},"Delete account"),". A crucial point is to make sure you don't have any existing Platform users that use the same email as LDAP users you want to add (in case emails are the primary identifiers of your LDAP users)."),(0,i.kt)("p",null,"Now that you have identified a unique attribute to be used as a username, to configure the LDAP SSO feature you have to:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Add ",(0,i.kt)("inlineCode",{parentName:"p"},"ldap")," to the comma separated list of authentication providers specified in ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_PROVIDERS")," environement variable.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Specify ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_URL")," to set a URI of the LDAP server. It must include a protocol, port, and path (if any). For instance, ",(0,i.kt)("inlineCode",{parentName:"p"},"ldap://ldap.example.com:389"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Specify LDAP usernames, DNs, or emails that you want to register in Mosquitto Platform as a comma separated list in the ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_CUSTOM_ALLOWED_SIGNUP_EMAILS")," environemnt varaible. Example: ",(0,i.kt)("inlineCode",{parentName:"p"},"testuser@myorg.com,testuser2@myorg.com"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Set ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SEARCH_BASE_DN")," to define a search base, i.e. a DN starting from which a search for users will be performed. Example: ",(0,i.kt)("inlineCode",{parentName:"p"},"dc=example,dc=org"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If you are using something such as an email instead of a full user DN as username in your systems, then you will need an administrative user to bind to LDAP and find a corresponding user record. Specify credentials to use when binding administrative user to the LDAP server using the following entironment varaibles: ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_ADMIN_DN")," (distinguished name of the admin user) and ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_ADMIN_PASSWORD")," (a plain text password) or ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_ADMIN_PASSWORD_FILE_PATH")," (a full path to a plain text file with the password). An example value for ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_ADMIN_DN")," can be: ",(0,i.kt)("inlineCode",{parentName:"p"},"cn=admin,dc=example,dc=org"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"After specifying all the required environment variables, you can start Mosquitto Platform and open it in your browser. If you don't have any users you will be greeted with a Setup screen where you can enter your LDAP credentials to create an admin user and sign in. In case you already have users in the platform, you will have to login using an admin account.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'After you are signed in as an admin, you can click on the top-right menu and choose "Admin board".')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'Navigate to "User management" and create new users specifying ',(0,i.kt)("inlineCode",{parentName:"p"},"LDAP")," as a user type.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},'You can also choose to make some users admins in "Administrators" section on the left-hand side.')),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"After users were created, they can be used to login to the Platform by entering LDAP credentials."))),(0,i.kt)("p",null,"You can optionally specify the following variables:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AUTH_LDAP_FILTER"),". The filter criteria of the user search as specified in RFC4515. To specify username of the application (usernmae field from login and sign up pages) put ",(0,i.kt)("inlineCode",{parentName:"li"},"%u")," into the filter string. Example: ",(0,i.kt)("inlineCode",{parentName:"li"},"(cn=%u)"),". This is needed if you are using a certain LDAP record's attribute such as an email instead of its full DN to identify a user."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AUTH_LDAP_SCOPE"),". Scope of the user search. User search is performed on the LDAP server. Possible values are ",(0,i.kt)("inlineCode",{parentName:"li"},"base")," - search only the search base (",(0,i.kt)("inlineCode",{parentName:"li"},"AUTH_LDAP_SEARCH_BASE_DN"),") entry. ",(0,i.kt)("inlineCode",{parentName:"li"},"one")," - search only the immediate children of the search base entry. ",(0,i.kt)("inlineCode",{parentName:"li"},"sub")," - search the search base entry as well as all its subordinates to any depth. ",(0,i.kt)("inlineCode",{parentName:"li"},"children")," - don't search the search base entry but serach its subordinates to any depth. Default value: ",(0,i.kt)("inlineCode",{parentName:"li"},"sub"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"AUTH_LDAP_DEREFERENCE_ALIASES"),". LDAP alias dereferencing policy as specified in ",(0,i.kt)("inlineCode",{parentName:"li"},"4.5.1.3")," subsection of RFC4511. Possible values are: ",(0,i.kt)("inlineCode",{parentName:"li"},"never")," - don't dereference aliases. ",(0,i.kt)("inlineCode",{parentName:"li"},"always")," - dereference aliases both in searching and in locating the base object of the search. ",(0,i.kt)("inlineCode",{parentName:"li"},"search")," - dereference aliases only when searching subordinates. ",(0,i.kt)("inlineCode",{parentName:"li"},"find")," - dereference aliases only in locating the base object of the search. The ",(0,i.kt)("inlineCode",{parentName:"li"},"always")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"find")," policies are applicable when aliases may be present in the search base object itself (",(0,i.kt)("inlineCode",{parentName:"li"},"AUTH_LDAP_SEARCH_BASE_DN"),"). Conversly, if aliases are present in subordinates of the serach base object, use ",(0,i.kt)("inlineCode",{parentName:"li"},"always")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"search"),". Default: ",(0,i.kt)("inlineCode",{parentName:"li"},"never"),".")),(0,i.kt)("p",null,"To define optoinal SSL options for ",(0,i.kt)("inlineCode",{parentName:"p"},"ldaps")," protocol, SSL must also be supported by the LDAP server. Note that the typical port for the LDAP secure connection is ",(0,i.kt)("inlineCode",{parentName:"p"},"636"),", so ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_URL")," might also need to be changed when using SSL:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_REJECT_UNAUTHORIZED")," - to specify whether to reject connections to LDAP servers that provide TLS certificates not trusted by the client (Mosquitto Platform). To set a particular custom certificate as trusted you will need to set ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_CA")," (or ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_CA_FILE_PATH"),") to a certificate of the certificates authority (CA) that issued this particular certificate of interest.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_CA")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_CA_FILE_PATH")," - to specify a plaintext or a full file path to a custom certificate of the certificate authority that issued the LDAP server's certificate in PEM foramt.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_CERT")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_CERT_FILE_PATH"),"- to specify a plaintext or a full file path to a client certificate which belongs to the application (Mosquitto Platform) and is acknowledged by the identity provider. Certificate in PEM format base 64 encoded.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_KEY")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_SSL_KEY_FILE_PATH")," - to specify a plaintext or a full file path to a private key of the client certificate which belongs to the application (osquitto Platform) in PEM format")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_CUSTOM_INFER_NAME")," - whether to try to extract user's first name and last name from the username field. This extraction will remove everything after the ",(0,i.kt)("inlineCode",{parentName:"p"},"@")," symbol in the username field and look for a seperator such as ",(0,i.kt)("inlineCode",{parentName:"p"},"."),", ",(0,i.kt)("inlineCode",{parentName:"p"},"-"),", ",(0,i.kt)("inlineCode",{parentName:"p"}," "),", or ",(0,i.kt)("inlineCode",{parentName:"p"},"_"),". If a separator is found, the first part of the string before it becomes user's first name and second part - their last name. If this variable is not set or first and last name could not be extracted, you will be able to set them in user settings."))),(0,i.kt)("p",null,"Note that when using LDAP authentication, the values in ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_CUSTOM_ALLOWED_SIGNUP_EMAILS")," should match the LDAP record's attribute you're using as a unique identifier for user authentication. As discussed in the beginning of this section, this may not necessarily be the full DN. The only requirements to such an attribute is that it should uniquely identify a user entry and be searchable with a filter criteria in ",(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_LDAP_FILTER"),". However, if you are actually using DNs, you must use double quotes around each DN and single quotes around the entire environment variable value. For example:\n",(0,i.kt)("inlineCode",{parentName:"p"},'AUTH_CUSTOM_ALLOWED_SIGNUP_EMAILS=\'"CN=John Doe,OU=Users,DC=example,DC=com","CN=Tom Second,OU=Users,DC=example,DC=com"\''),"\nAdditinally, note that in case of using full DNs you will be specifying them as usernames when signing up and logging into Mosquitto Platform and you don't have to specify an admin user credentials in this case. Admin user is used to search for a record and find it's DN. So, if you are using DNs, the user will be bound to LDAP directly without requiring a search step.\nNote that using DNs directly is not recommended as not only are they complex as they capture a hierarchical structure of the directory service but they may alsoee change when modifications to the user record are made (e.g. organisation changes)."),(0,i.kt)("p",null,"To debug LDAP authentication flow:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Set ",(0,i.kt)("inlineCode",{parentName:"li"},"AUTH_CUSTOM_DEBUG")," environement variable to ",(0,i.kt)("inlineCode",{parentName:"li"},"1"))),(0,i.kt)("h3",u({},{id:"limitations"}),"Limitations"),(0,i.kt)("p",null,"SASL authenticaton mechanisms are currently not supported."))}k.isMDXComponent=!0}}]);