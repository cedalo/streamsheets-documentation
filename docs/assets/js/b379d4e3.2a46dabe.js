"use strict";(self.webpackChunkstreamsheets=self.webpackChunkstreamsheets||[]).push([[19865],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(n),d=i,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||r;return n?a.createElement(k,o(o({ref:t},p),{},{components:n})):a.createElement(k,o({ref:t},p))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var u=2;u<r;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},30586:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>g,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>k,toc:()=>N});var a=n(3905),i=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,p=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t)=>{for(var n in t||(t={}))s.call(t,n)&&p(e,n,t[n]);if(l)for(var n of l(t))u.call(t,n)&&p(e,n,t[n]);return e};const c={id:"single-node",title:"Kubernetes Single Node",sidebar_label:"Single Node"},d=void 0,k={unversionedId:"deployment/on-premises/deployment/installation/kubernetes/single-node",id:"version-3.1/deployment/on-premises/deployment/installation/kubernetes/single-node",title:"Kubernetes Single Node",description:"This setup will deploy Single node Mosquitto broker and a Platform portal on a managed kubernetes cluster like GKE (Google), EKS (Amazon) or Azure Kubernetes using Helm charts.",source:"@site/mosquitto_versioned_docs/version-3.1/deployment/on-premises/deployment/installation/kubernetes/single-node.md",sourceDirName:"deployment/on-premises/deployment/installation/kubernetes",slug:"/deployment/on-premises/deployment/installation/kubernetes/single-node",permalink:"/mosquitto/deployment/on-premises/deployment/installation/kubernetes/single-node",draft:!1,tags:[],version:"3.1",frontMatter:{id:"single-node",title:"Kubernetes Single Node",sidebar_label:"Single Node"},sidebar:"someSidebar",previous:{title:"Introduction",permalink:"/mosquitto/deployment/on-premises/deployment/installation/kubernetes/introduction-kubernetes"},next:{title:"High Availability",permalink:"/mosquitto/deployment/on-premises/deployment/installation/kubernetes/high-availability"}},g={},N=[{value:"Kubernetes Setup",id:"kubernetes-setup",level:2},{value:"Dependencies and Prerequisites",id:"dependencies-and-prerequisites",level:3},{value:"Installation",id:"installation",level:2},{value:"Installation using Helm Charts:",id:"installation-using-helm-charts",level:3},{value:"Connect to Broker",id:"connect-to-broker",level:2},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Configurable Mosquitto Broker Settings",id:"configurable-mosquitto-broker-settings",level:3},{value:"<strong>Mosquitto Configuration Options</strong>",id:"mosquitto-configuration-options",level:4},{value:"<strong>Plugin Configuration</strong>",id:"plugin-configuration",level:4},{value:"<strong>Complete Example with Custom Configuration</strong>",id:"complete-example-with-custom-configuration",level:4},{value:"<strong>Updating Configuration After Installation</strong>",id:"updating-configuration-after-installation",level:4},{value:"Prometheus Monitoring Integration",id:"prometheus-monitoring-integration",level:3},{value:"<strong>Prerequisites</strong>",id:"prerequisites",level:4},{value:"<strong>Configuration Options</strong>",id:"configuration-options",level:4},{value:"<strong>Key Configuration Parameters</strong>",id:"key-configuration-parameters",level:4},{value:"<strong>Verifying Prometheus Integration</strong>",id:"verifying-prometheus-integration",level:4},{value:"<strong>Troubleshooting</strong>",id:"troubleshooting",level:4},{value:"NetworkPolicy Security (Optional)",id:"networkpolicy-security-optional",level:2},{value:"Prerequisites",id:"prerequisites-1",level:3},{value:"Enable NetworkPolicies",id:"enable-networkpolicies",level:3},{value:"DNS Configuration (Configurable)",id:"dns-configuration-configurable",level:3},{value:"Default Configuration (Standard Kubernetes)",id:"default-configuration-standard-kubernetes",level:4},{value:"Custom DNS Configuration",id:"custom-dns-configuration",level:4},{value:"Detect DNS Configuration",id:"detect-dns-configuration",level:4},{value:"What NetworkPolicies Control",id:"what-networkpolicies-control",level:3},{value:"Verification",id:"verification",level:3},{value:"Important Notes",id:"important-notes",level:3},{value:"Usage",id:"usage",level:2}],f={toc:N};function h(e){var t,n=e,{components:i}=n,p=((e,t)=>{var n={};for(var a in e)s.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&l)for(var a of l(e))t.indexOf(a)<0&&u.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=m(m({},f),p),r(t,o({components:i,mdxType:"MDXLayout"}))),(0,a.kt)("p",null,"This setup will deploy Single node Mosquitto broker and a Platform portal on a managed kubernetes cluster like GKE (Google), EKS (Amazon) or Azure Kubernetes using Helm charts.\nThis deployment by default uses a Persistent volumes for persistence, and also deploys a service called mosquitto to act as a connection endpoint. Platform pod is deployed as a deployment entity and mosquitto broker as statefulset."),(0,a.kt)("h2",m({},{id:"kubernetes-setup"}),"Kubernetes Setup"),(0,a.kt)("h3",m({},{id:"dependencies-and-prerequisites"}),"Dependencies and Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Running managed kubernetes setup (GKE, EKS, AKS etc). Follow documentation guide for the respective kubernetes cluster to create a cluster on your chosen cloud provider."),(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Create a namespace")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Once you are connected to your Kubernetes setup and can access the cluster using ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl")," tool. Create a namespace in which you would want to deploy the application. The deployment folder is pre-configured for the namespace named ",(0,a.kt)("inlineCode",{parentName:"li"},"singlenode"),". If you want to use the default configuration you can create a namespace named ",(0,a.kt)("inlineCode",{parentName:"li"},"singlenode")," using the below command:"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"kubectl create namespace singlenode")),(0,a.kt)("li",{parentName:"ul"},"If you want to use a different namespace, use the command: ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl create namespace <your-custom-namespace>"),".  Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"<your-custom-namespace>")," with the name of the namespace you want to configure.")))),(0,a.kt)("h2",m({},{id:"installation"}),"Installation"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Prerequisites"),":"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Kubernetes Cluster should be up and running. If you are yet to setup the cluster, refer ",(0,a.kt)("a",m({parentName:"li"},{href:"#kubernetes-cluster-setup"}),"Kubernetes Cluster Setup"),"."),(0,a.kt)("li",{parentName:"ol"},"You have successfully created the namespace")),(0,a.kt)("p",null,"Once kubernetes cluster is up and running then you can now follow these steps to install the Single node Mosquitto broker setup:"),(0,a.kt)("h3",m({},{id:"installation-using-helm-charts"}),"Installation using Helm Charts:"),(0,a.kt)("p",null,"Helm charts offer a comprehensive solution for configuring various Kubernetes resources\u2014including stateful sets, deployment templates, services, and service accounts\u2014through a single command, streamlining the deployment process.When the user downloads helm package from the Platform license key is already part of the package."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Get the helm chart")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Make sure you have the helm chart  ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-3.1-platform-3.1-kubernetes-sn.tgz")," downloaded from the platform portal."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Install Helm Chart:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Use the following ",(0,a.kt)("inlineCode",{parentName:"p"},"helm install")," command to deploy the Mosquitto application on to your Kubernetes cluster. Replace ",(0,a.kt)("inlineCode",{parentName:"p"},"<release-name>")," with the desired name for your Helm release and ",(0,a.kt)("inlineCode",{parentName:"p"},"<namespace>")," with your chosen Kubernetes namespace:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"helm install <release-name> mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n <namespace>\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Required Parameters:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set licenseKey=<your-license-key>"),": Your Cedalo Mosquitto license key (required)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set nameserver=<dns-server-ip>"),": DNS server IP address for name resolution (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"10.0.0.10"),")"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Common Configuration Options:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set storageClass=<storage-class-name>"),": Storage class for persistent volumes. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"standard-rwo")," (GCP). Common values:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"GCP: ",(0,a.kt)("inlineCode",{parentName:"li"},"standard-rwo"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"premium-rwo")),(0,a.kt)("li",{parentName:"ul"},"AWS: ",(0,a.kt)("inlineCode",{parentName:"li"},"gp2"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"gp3"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"io1")),(0,a.kt)("li",{parentName:"ul"},"Azure: ",(0,a.kt)("inlineCode",{parentName:"li"},"managed"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"managed-premium")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serviceType=<serviceType>"),": Service type for MQTT broker. Options: ",(0,a.kt)("inlineCode",{parentName:"li"},"LoadBalancer")," (default), ",(0,a.kt)("inlineCode",{parentName:"li"},"NodePort"),", or ",(0,a.kt)("inlineCode",{parentName:"li"},"ClusterIP")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set platform.serviceType=<serviceType>"),": Service type for Platform UI. Options: ",(0,a.kt)("inlineCode",{parentName:"li"},"LoadBalancer")," (default), ",(0,a.kt)("inlineCode",{parentName:"li"},"NodePort"),", or ",(0,a.kt)("inlineCode",{parentName:"li"},"ClusterIP")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.pullPolicy=<pullPolicy>"),": Image pull policy. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"Always"),". Options: ",(0,a.kt)("inlineCode",{parentName:"li"},"Always"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"IfNotPresent"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"Never")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set imagePullSecrets[0].name=<secret-name>"),": Image pull secret for private registries. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-pro-secret")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Storage Configuration:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.persistentStorageCapacity=<size>"),": Storage size for Mosquitto data. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"1Gi")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set platform.persistentStorageCapacity=<size>"),": Storage size for Platform data. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"1Gi")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set platform.persistentLogStorageCapacity=<size>"),": Storage size for Platform logs. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"1Gi")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Resource Configuration:")),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.resources.requests.cpu=<cpu>"),": Mosquitto CPU request. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"200m")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.resources.requests.memory=<memory>"),": Mosquitto memory request. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"512Mi")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set platform.resources.requests.cpu=<cpu>"),": Platform CPU request. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"200m")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set platform.resources.requests.memory=<memory>"),": Platform memory request. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"512Mi")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Sample Installation Command:")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"helm install sample-release mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n singlenode \\\n  --set licenseKey=<your-license-key> \\\n  --set nameserver=10.0.0.10 \\\n  --set storageClass=standard-rwo \\\n  --set mosquitto.serviceType=LoadBalancer \\\n  --set platform.serviceType=LoadBalancer\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Note:")," You can explore further configuration options in ",(0,a.kt)("inlineCode",{parentName:"p"},"values.yaml"))))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"You can monitor the running pods using the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods -o wide -n <namespace>")," command. To observe the opened ports use ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get svc -n <namespace>"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"To uninstall the setup:\n",(0,a.kt)("inlineCode",{parentName:"p"},"helm uninstall <release-name> -n <namespace>")))),(0,a.kt)("p",null,"Your Mosquitto setup is now running  with a single mosquitto nodes and the Platform portal."),(0,a.kt)("h2",m({},{id:"connect-to-broker"}),"Connect to Broker"),(0,a.kt)("p",null,"Once your setup is ready, you can access the mosquitto brokers using the external ip of the mosquitto service.\nGo to the ",(0,a.kt)("inlineCode",{parentName:"p"},"Client Account"),' menu on the Platform portal and create a new client to connect from. Make sure to assign a role, like the default "client" role, to allow your client to publish and/or subscribe to topics.\nNow you can connect to the Mosquitto cluster. You can access it either with connecting it directly to worker node running the haproxy pod along with a service exposed at port 1883:'),(0,a.kt)("p",null,"To get the external ip of mosquitto-loadbalancer service:\n",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get service mosquitto-loadbalancer -n <namespace>")),(0,a.kt)("p",null,"In this example command we use Mosquitto Sub to subscribe onto all topics:\n",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto_sub -h <external-ip-of-mosquitto-loadbalancer> -p 1883 -u <username> -P <password> -t '#'")),(0,a.kt)("p",null,"Make sure to replace your IP, username and password."),(0,a.kt)("h2",m({},{id:"advanced-configuration"}),"Advanced Configuration"),(0,a.kt)("h3",m({},{id:"configurable-mosquitto-broker-settings"}),"Configurable Mosquitto Broker Settings"),(0,a.kt)("p",null,"The Helm chart now supports ",(0,a.kt)("strong",{parentName:"p"},"dynamic configuration")," of the Mosquitto broker through ",(0,a.kt)("inlineCode",{parentName:"p"},"values.yaml"),", eliminating the need to modify and repackage the chart. All broker settings can be configured using ",(0,a.kt)("inlineCode",{parentName:"p"},"--set")," flags during installation or upgrade."),(0,a.kt)("h4",m({},{id:"mosquitto-configuration-options"}),(0,a.kt)("strong",{parentName:"h4"},"Mosquitto Configuration Options")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Basic Broker Settings:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.config.allowAnonymous=<true|false>"),": Allow unauthenticated access. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.config.maxQueuedMessages=<number>"),": Maximum queued messages per client. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"1000")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.config.maxInflightMessages=<number>"),": Maximum inflight messages per client. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"100")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.config.enableDebugLogging=<true|false>"),": Enable debug logging. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"WebSockets Support:")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.config.enableWebsockets=<true|false>"),": Enable WebSockets listener. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.config.websocketsPort=<port>"),": WebSockets port. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"8090"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"TLS Configuration:")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Server-Only TLS (One-way TLS):")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.enabled=true"),": Enable server-only TLS listener on port 8883. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.secretName=<secret-name>"),": Name of the Secret containing server TLS certificates. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-server-tls")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.createSecret=false"),": Set to ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," if creating secrets externally (recommended). Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.certFile=<filename>"),": Certificate file name in Secret. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.crt")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.keyFile=<filename>"),": Private key file name in Secret. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.key")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.tlsMountPath=<path>"),": Directory path for mounted certificates. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mosquitto/certs")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.certName=<filename>"),": Certificate filename when mounted. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.crt")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.serverOnlyTls.keyName=<filename>"),": Private key filename when mounted. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.key"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"mTLS (Mutual TLS - Two-way TLS):")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.enabled=true"),": Enable mTLS listener on port 8883. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.secretName=<secret-name>"),": Name of the Secret containing server TLS certificates for mTLS. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-mtls-server-tls")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.createSecret=false"),": Set to ",(0,a.kt)("inlineCode",{parentName:"li"},"false")," if creating secrets externally (recommended). Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.certFile=<filename>"),": Certificate file name in Secret. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.pem")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.keyFile=<filename>"),": Private key file name in Secret. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"server.key")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.clientCaSecretName=<secret-name>"),": Name of the Secret containing client CA certificates (must be created externally). Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto-client-ca")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.caMountPath=<path>"),": Directory path for client CA certificates (capath). Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mosquitto/config/capath_mqtts")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.requireCertificate=<true|false>"),": Require clients to present valid certificates. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.useIdentityAsUsername=<true|false>"),": Use certificate CN as username. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"--set mosquitto.mtls.tlsVersion=<version>"),": Minimum TLS version (e.g., ",(0,a.kt)("inlineCode",{parentName:"li"},"tlsv1.2"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"tlsv1.3"),"). Default: ",(0,a.kt)("inlineCode",{parentName:"li"},'""')," (uses Mosquitto default)")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," All secret names and paths mentioned above are ",(0,a.kt)("strong",{parentName:"p"},"default values")," and can be customized via Helm values. Certificates can be created externally using ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl create secret")," commands. For detailed TLS configuration, see the ",(0,a.kt)("a",m({parentName:"p"},{href:"/mosquitto/security/certificates/server-certificates"}),"Server Certificates")," and ",(0,a.kt)("a",m({parentName:"p"},{href:"/mosquitto/security/certificates/mtls"}),"mTLS")," documentation."),(0,a.kt)("h4",m({},{id:"plugin-configuration"}),(0,a.kt)("strong",{parentName:"h4"},"Plugin Configuration")),(0,a.kt)("p",null,"The Helm chart supports enabling and configuring various Mosquitto plugins:"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Data Validation Plugin:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"--set mosquitto.config.plugins.dataValidation.enabled=true\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"InfluxDB Metrics Plugin:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"--set mosquitto.config.plugins.influxdbMetrics.enabled=true \\\n--set mosquitto.config.plugins.influxdbMetrics.host=<influxdb-host> \\\n--set mosquitto.config.plugins.influxdbMetrics.port=8086 \\\n--set mosquitto.config.plugins.influxdbMetrics.database=<db-name> \\\n--set mosquitto.config.plugins.influxdbMetrics.updateInterval=60\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Prometheus Metrics Plugin:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"--set prometheus.enabled=true \\\n--set mosquitto.config.plugins.prometheusMetrics.enabled=true \\\n--set mosquitto.config.plugins.prometheusMetrics.port=8000 \\\n--set mosquitto.config.plugins.prometheusMetrics.updateInterval=15\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Authentication Plugins:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# LDAP Authentication\n--set mosquitto.config.plugins.ldap.enabled=true\n\n# JWT Authentication\n--set mosquitto.config.plugins.jwt.enabled=true\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Audit Plugins:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# MQTT5 Audit\n--set mosquitto.config.plugins.audit.mqtt5.enabled=true\n\n# Message Audit\n--set mosquitto.config.plugins.audit.message.enabled=true\n\n# Protocol Audit\n--set mosquitto.config.plugins.audit.protocol.enabled=true\n")),(0,a.kt)("h4",m({},{id:"complete-example-with-custom-configuration"}),(0,a.kt)("strong",{parentName:"h4"},"Complete Example with Custom Configuration")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"helm install my-broker mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n singlenode \\\n  --set licenseKey=<your-license-key> \\\n  --set nameserver=10.0.0.10 \\\n  --set storageClass=gp3 \\\n  --set mosquitto.serviceType=LoadBalancer \\\n  --set platform.serviceType=LoadBalancer \\\n  --set mosquitto.config.allowAnonymous=false \\\n  --set mosquitto.config.maxQueuedMessages=5000 \\\n  --set mosquitto.config.maxInflightMessages=200 \\\n  --set mosquitto.config.enableWebsockets=true \\\n  --set mosquitto.config.plugins.prometheusMetrics.enabled=true \\\n  --set prometheus.enabled=true \\\n  --set mosquitto.resources.requests.cpu=500m \\\n  --set mosquitto.resources.requests.memory=1Gi\n")),(0,a.kt)("h4",m({},{id:"updating-configuration-after-installation"}),(0,a.kt)("strong",{parentName:"h4"},"Updating Configuration After Installation")),(0,a.kt)("p",null,"To update the configuration after installation, use ",(0,a.kt)("inlineCode",{parentName:"p"},"helm upgrade"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# Enable Prometheus monitoring\nhelm upgrade <release-name> mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n <namespace> \\\n  --reuse-values \\\n  --set prometheus.enabled=true \\\n  --set mosquitto.config.plugins.prometheusMetrics.enabled=true\n\n# Update max queued messages\nhelm upgrade <release-name> mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n <namespace> \\\n  --reuse-values \\\n  --set mosquitto.config.maxQueuedMessages=10000\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Note:")," Configuration changes to ",(0,a.kt)("inlineCode",{parentName:"p"},"mosquitto.config")," automatically trigger pod restarts to apply the new settings (using ConfigMap checksums)."),(0,a.kt)("h3",m({},{id:"prometheus-monitoring-integration"}),"Prometheus Monitoring Integration"),(0,a.kt)("p",null,"The Helm chart includes built-in support for Prometheus monitoring through the Mosquitto Prometheus Metrics plugin and Kubernetes ServiceMonitor."),(0,a.kt)("h4",m({},{id:"prerequisites"}),(0,a.kt)("strong",{parentName:"h4"},"Prerequisites")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"IMPORTANT:")," Before enabling Prometheus monitoring with ServiceMonitor, ensure the ",(0,a.kt)("strong",{parentName:"p"},"Prometheus Operator")," is installed in your cluster. Without it, the Helm installation will fail with an error about missing Custom Resource Definitions (CRDs)."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Option 1: Install Prometheus Operator (Recommended)")),(0,a.kt)("p",null,"Install the ",(0,a.kt)("inlineCode",{parentName:"p"},"kube-prometheus-stack")," which includes Prometheus Operator, Prometheus server, Grafana, and all required CRDs:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# Add Prometheus community Helm repository\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n\n# Install kube-prometheus-stack\nhelm install prometheus prometheus-community/kube-prometheus-stack -n monitoring --create-namespace\n")),(0,a.kt)("p",null,"Wait for the Prometheus Operator to be ready:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"kubectl wait --for=condition=ready pod -l app.kubernetes.io/name=prometheus-operator -n monitoring --timeout=300s\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Option 2: Install Without ServiceMonitor")),(0,a.kt)("p",null,"If you don't want to use Prometheus Operator, you can:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Deploy only the Prometheus server (basic chart)"),(0,a.kt)("li",{parentName:"ul"},"Disable ServiceMonitor in the Mosquitto Helm chart"),(0,a.kt)("li",{parentName:"ul"},"Manually configure Prometheus scrape configs")),(0,a.kt)("h4",m({},{id:"configuration-options"}),(0,a.kt)("strong",{parentName:"h4"},"Configuration Options")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Full Prometheus Integration (with ServiceMonitor):")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'helm install my-broker mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n singlenode \\\n  --set licenseKey=<your-license-key> \\\n  --set nameserver=10.0.0.10 \\\n  --set prometheus.enabled=true \\\n  --set prometheus.serviceMonitor.enabled=true \\\n  --set mosquitto.config.plugins.prometheusMetrics.enabled=true \\\n  --set mosquitto.config.plugins.prometheusMetrics.port=8000 \\\n  --set mosquitto.config.plugins.prometheusMetrics.bindAddress="0.0.0.0" \\\n  --set mosquitto.config.plugins.prometheusMetrics.updateInterval=15\n')),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Prometheus Without ServiceMonitor (manual scraping):")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"helm install my-broker mosquitto-3.1-platform-3.1-kubernetes-sn.tgz -n singlenode \\\n  --set licenseKey=<your-license-key> \\\n  --set nameserver=10.0.0.10 \\\n  --set prometheus.enabled=true \\\n  --set prometheus.serviceMonitor.enabled=false \\\n  --set mosquitto.config.plugins.prometheusMetrics.enabled=true\n")),(0,a.kt)("h4",m({},{id:"key-configuration-parameters"}),(0,a.kt)("strong",{parentName:"h4"},"Key Configuration Parameters")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.enabled"),": Master switch for Prometheus support. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.serviceMonitor.enabled"),": Enable ServiceMonitor creation (requires Prometheus Operator). Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"true")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.serviceMonitor.interval"),": Scrape interval. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"30s")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.serviceMonitor.scrapeTimeout"),": Scrape timeout. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"10s")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.serviceMonitor.releaseLabel"),": Release label for Prometheus discovery. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"prometheus")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.config.plugins.prometheusMetrics.enabled"),": Enable Mosquitto Prometheus plugin. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"false")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.config.plugins.prometheusMetrics.port"),": Metrics endpoint port. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"8000")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.config.plugins.prometheusMetrics.bindAddress"),": Bind address for metrics endpoint. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"0.0.0.0")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"mosquitto.config.plugins.prometheusMetrics.updateInterval"),": Metrics update interval in seconds. Default: ",(0,a.kt)("inlineCode",{parentName:"li"},"15"))),(0,a.kt)("h4",m({},{id:"verifying-prometheus-integration"}),(0,a.kt)("strong",{parentName:"h4"},"Verifying Prometheus Integration")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Check if ServiceMonitor is created:")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"kubectl get servicemonitor -n <namespace>\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Verify Mosquitto metrics endpoint:")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# Port-forward to Mosquitto pod\nkubectl port-forward -n <namespace> mosquitto-0 8000:8000\n\n# In another terminal, check metrics\ncurl http://localhost:8000/metrics\n"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"Check Prometheus targets (if using kube-prometheus-stack):")),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Port-forward to Prometheus UI\nkubectl port-forward -n monitoring svc/prometheus-kube-prometheus-prometheus 9090:9090\n\n# Open browser: http://localhost:9090/targets\n# Look for "mosquitto-prometheus-metrics" target\n')))),(0,a.kt)("h4",m({},{id:"troubleshooting"}),(0,a.kt)("strong",{parentName:"h4"},"Troubleshooting")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},'Error: "no matches for kind ServiceMonitor"')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cause:")," Prometheus Operator CRDs not installed"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Solution:")," Install ",(0,a.kt)("inlineCode",{parentName:"li"},"kube-prometheus-stack")," or disable ServiceMonitor with ",(0,a.kt)("inlineCode",{parentName:"li"},"--set prometheus.serviceMonitor.enabled=false"))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},'Prometheus shows "No targets" for Mosquitto')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cause:")," ServiceMonitor label selector doesn't match"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Solution:")," Verify the ",(0,a.kt)("inlineCode",{parentName:"li"},"prometheus.serviceMonitor.releaseLabel")," matches your Prometheus Operator's release name")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Metrics endpoint returns 404")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cause:")," Prometheus plugin not properly configured or binding to localhost only"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Solution:")," Ensure ",(0,a.kt)("inlineCode",{parentName:"li"},'mosquitto.config.plugins.prometheusMetrics.bindAddress="0.0.0.0"'))),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"ServiceMonitor created but no data in Prometheus")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cause:")," Prometheus Operator might not be watching the namespace"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Solution:")," Check Prometheus Operator logs and ensure it has RBAC permissions for the target namespace")),(0,a.kt)("p",null,"Access the metrics endpoint at: ",(0,a.kt)("inlineCode",{parentName:"p"},"http://<mosquitto-service>:8000/metrics")),(0,a.kt)("h2",m({},{id:"networkpolicy-security-optional"}),"NetworkPolicy Security (Optional)"),(0,a.kt)("p",null,"For enhanced security, you can enable NetworkPolicies to control traffic flow between pods. This restricts network access to only necessary connections."),(0,a.kt)("h3",m({},{id:"prerequisites-1"}),"Prerequisites"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"CNI Plugin"),": Your cluster must support NetworkPolicies (Calico, Cilium, Weave Net, etc.)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"NetworkPolicy Support"),": Verify with ",(0,a.kt)("inlineCode",{parentName:"li"},"kubectl get crd networkpolicies.networking.k8s.io"))),(0,a.kt)("h3",m({},{id:"enable-networkpolicies"}),"Enable NetworkPolicies"),(0,a.kt)("p",null,"Add the following to your Helm installation:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"--set networkPolicy.enabled=true\n")),(0,a.kt)("h3",m({},{id:"dns-configuration-configurable"}),"DNS Configuration (Configurable)"),(0,a.kt)("p",null,"NetworkPolicies require DNS resolution to work properly. The Helm chart includes configurable DNS settings that automatically adapt to different cluster environments:"),(0,a.kt)("h4",m({},{id:"default-configuration-standard-kubernetes"}),"Default Configuration (Standard Kubernetes)"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-yaml"}),'networkPolicy:\n  enabled: true\n  dns:\n    namespace: "kube-system"\n    podSelector:\n      key: "k8s-app"\n      value: "coredns"\n    ports:\n      udp: 53\n      tcp: 53\n')),(0,a.kt)("h4",m({},{id:"custom-dns-configuration"}),"Custom DNS Configuration"),(0,a.kt)("p",null,"For non-standard clusters, you can customize DNS settings:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"helm install mosquitto-sn . -n <namespace> \\\n  --set networkPolicy.enabled=true \\\n  --set networkPolicy.dns.namespace=<dns-namespace> \\\n  --set networkPolicy.dns.podSelector.key=<selector-key> \\\n  --set networkPolicy.dns.podSelector.value=<selector-value> \\\n  --set networkPolicy.dns.ports.udp=<dns-udp-port> \\\n  --set networkPolicy.dns.ports.tcp=<dns-tcp-port>\n")),(0,a.kt)("h4",m({},{id:"detect-dns-configuration"}),"Detect DNS Configuration"),(0,a.kt)("p",null,"Use these commands to find your cluster's DNS configuration:"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"# Find DNS namespace\nkubectl get pods --all-namespaces | grep -E 'dns|core-dns'\n\n# Find DNS pod labels\nkubectl get pods -n kube-system --show-labels | grep -E 'dns|coredns'\nkubectl get pods -n openshift-dns --show-labels | grep dns\n\n# Find DNS service ports\nkubectl describe svc kube-dns -n kube-system | grep -A 5 \"Port:\"\nkubectl describe svc coredns -n kube-system | grep -A 5 \"Port:\"\n")),(0,a.kt)("h3",m({},{id:"what-networkpolicies-control"}),"What NetworkPolicies Control"),(0,a.kt)("p",null,"The Helm chart creates 3 NetworkPolicy resources:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Mosquitto NetworkPolicy"),": Controls external MQTT access (1883/8883), Platform communication (1885, 1883/8883), and Prometheus metrics (8000)"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Platform NetworkPolicy"),": Controls web UI access (3000/443) and Mosquitto communication"),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Image Registry Policy"),": Permits image pulls from ",(0,a.kt)("inlineCode",{parentName:"li"},"registry.cedalo.com"))),(0,a.kt)("h3",m({},{id:"verification"}),"Verification"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'# Check NetworkPolicies are created\nkubectl get networkpolicies -n <namespace>\n\n# Test connectivity (should work normally)\nkubectl exec -it <mosquitto-pod> -- mosquitto_pub -h localhost -t test -m "hello"\n\n# Test DNS resolution from platform pod\nkubectl exec -it <platform-pod> -- nslookup mosquitto-0.mosquitto.ha.svc.cluster.local\n')),(0,a.kt)("h3",m({},{id:"important-notes"}),"Important Notes"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Default Behavior"),": Without NetworkPolicies, all pods can communicate freely"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"CNI Requirement"),": NetworkPolicies only work with compatible CNI plugins"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"DNS Dependency"),": NetworkPolicies require proper DNS configuration for service discovery"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Standard Kubernetes DNS"),": Uses port 53 (UDP/TCP)"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Troubleshooting"),": If connectivity issues occur, disable with ",(0,a.kt)("inlineCode",{parentName:"li"},"--set networkPolicy.enabled=false"))),(0,a.kt)("p",null,"For detailed NetworkPolicy documentation, see the ",(0,a.kt)("inlineCode",{parentName:"p"},"NETWORK-POLICY.md")," file in the Helm chart directory."),(0,a.kt)("h2",m({},{id:"usage"}),"Usage"),(0,a.kt)("p",null,"Once the installation is complete, you can start using the single-node Mosquitto broker. Be sure to check the Mosquitto documentation for further details on configuring and using the broker."))}h.isMDXComponent=!0}}]);